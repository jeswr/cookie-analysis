<!DOCTYPE html><html lang="en" dir="ltr"><head>
<meta charset="utf-8">
<meta name="generator" content="ReSpec 35.0.0">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>
span.example-title{text-transform:none}
:is(aside,div).example,div.illegal-example{padding:.5em;margin:1em 0;position:relative;clear:both}
div.illegal-example{color:red}
div.illegal-example p{color:#000}
aside.example div.example{border-left-width:.1em;border-color:#999;background:#fff}
</style>
<style>
.issue-label{text-transform:initial}
.warning>p:first-child{margin-top:0}
.warning{padding:.5em;border-left-width:.5em;border-left-style:solid}
span.warning{padding:.1em .5em .15em}
.issue.closed span.issue-number{text-decoration:line-through}
.issue.closed span.issue-number::after{content:" (Closed)";font-size:smaller}
.warning{border-color:#f11;border-color:var(--warning-border,#f11);border-width:.2em;border-style:solid;background:#fbe9e9;background:var(--warning-bg,#fbe9e9);color:#000;color:var(--text,#000)}
.warning-title:before{content:"⚠";font-size:1.3em;float:left;padding-right:.3em;margin-top:-.3em}
li.task-list-item{list-style:none}
input.task-list-item-checkbox{margin:0 .35em .25em -1.6em;vertical-align:middle}
.issue a.respec-gh-label{padding:5px;margin:0 2px 0 2px;font-size:10px;text-transform:none;text-decoration:none;font-weight:700;border-radius:4px;position:relative;bottom:2px;border:none;display:inline-block}
</style>
<style>
pre.idl{padding:1em;position:relative}
pre.idl>code{color:#000;color:var(--text,#000)}
@media print{
pre.idl{white-space:pre-wrap}
}
.idlHeader{display:block;width:150px;background:#8ccbf2;background:var(--def-border,#8ccbf2);color:#fff;color:var(--defrow-border,#fff);font-family:sans-serif;font-weight:700;margin:-1em 0 1em -1em;height:28px;line-height:28px}
.idlHeader a.self-link{margin-left:.3cm;text-decoration:none;border-bottom:none;color:inherit}
.idlID{font-weight:700;color:#005a9c}
.idlType{color:#005a9c}
.idlName{color:#ff4500}
.idlName a{color:#ff4500;border-bottom:1px dotted #ff4500;text-decoration:none}
a.idlEnumItem{color:#000;border-bottom:1px dotted #ccc;text-decoration:none}
.idlSuperclass{font-style:italic;color:#005a9c}
.idlDefaultValue,.idlParamName{font-style:italic}
.extAttr{color:#666}
.idlSectionComment{color:gray}
.idlIncludes a{font-weight:700}
.respec-button-copy-paste:focus{text-decoration:none;border-color:#51a7e8;outline:0;box-shadow:0 0 5px rgba(81,167,232,.5)}
.respec-button-copy-paste:is(:focus:hover,.selected:focus){border-color:#51a7e8}
.respec-button-copy-paste:is(:hover,:active,.zeroclipboard-is-hover,.zeroclipboard-is-active){text-decoration:none;background-color:#ddd;background-image:linear-gradient(#eee,#ddd);border-color:#ccc}
.respec-button-copy-paste:is(:active,.selected,.zeroclipboard-is-active){background-color:#dcdcdc;background-image:none;border-color:#b5b5b5;box-shadow:inset 0 2px 4px rgba(0,0,0,.15)}
.respec-button-copy-paste.selected:hover{background-color:#cfcfcf}
.respec-button-copy-paste:is(:disabled,:disabled:hover,.disabled,.disabled:hover){color:rgba(102,102,102,.5);cursor:default;background-color:rgba(229,229,229,.5);background-image:none;border-color:rgba(197,197,197,.5);box-shadow:none}
@media print{
.respec-button-copy-paste{visibility:hidden}
}
</style>
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;background:var(--indextable-hover-bg,#fff);color:#000;color:var(--text,#000);box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);box-shadow:0 1em 3em -.4em var(--tocsidebar-shadow,rgba(0,0,0,.3)),0 0 1px 1px var(--tocsidebar-shadow,rgba(0,0,0,.05));border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;border-bottom-color:var(--indextable-hover-bg,#fff);top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1;border-bottom-color:var(--indextable-hover-bg,#a2a9b1)}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;color:var(--text,#000);margin-top:.25em}
.dfn-panel ul a[href]{color:#333;color:var(--text,#333)}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>

<title>Strings on the Web: Language and Direction Metadata</title>


<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
.self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
aside.example .marker>a.self-link{color:inherit}
.header-wrapper{display:flex;align-items:baseline}
:is(h2,h3,h4,h5,h6):not(#toc>h2,#abstract>h2,#sotd>h2,.head>h2){position:relative;left:-.5em}
:is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-1.1em;font-size:1rem;opacity:.5}
:is(h2,h3,h4,h5,h6)+a.self-link::before{content:"§";text-decoration:none;color:var(--heading-text)}
:is(h2,h3)+a.self-link{top:-.2em}
:is(h4,h5,h6)+a.self-link::before{color:#000}
@media (max-width:767px){
dd{margin-left:0}
}
@media print{
.removeOnSave{display:none}
}
</style>


<link rel="stylesheet" href="local.css">


<meta name="description" content="This document describes the best practices for identifying the language and direction for strings used on the Web.">
<link rel="canonical" href="https://www.w3.org/TR/string-meta/">
<style>
.hljs{--base:#fafafa;--mono-1:#383a42;--mono-2:#686b77;--mono-3:#717277;--hue-1:#0b76c5;--hue-2:#336ae3;--hue-3:#a626a4;--hue-4:#42803c;--hue-5:#ca4706;--hue-5-2:#c91243;--hue-6:#986801;--hue-6-2:#9a6a01}
@media (prefers-color-scheme:dark){
.hljs{--base:#282c34;--mono-1:#abb2bf;--mono-2:#818896;--mono-3:#5c6370;--hue-1:#56b6c2;--hue-2:#61aeee;--hue-3:#c678dd;--hue-4:#98c379;--hue-5:#e06c75;--hue-5-2:#be5046;--hue-6:#d19a66;--hue-6-2:#e6c07b}
}
.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;color:var(--mono-1,#383a42);background:#fafafa;background:var(--base,#fafafa)}
.hljs-comment,.hljs-quote{color:#717277;color:var(--mono-3,#717277);font-style:italic}
.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4;color:var(--hue-3,#a626a4)}
.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ca4706;color:var(--hue-5,#ca4706);font-weight:700}
.hljs-literal{color:#0b76c5;color:var(--hue-1,#0b76c5)}
.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#42803c;color:var(--hue-4,#42803c)}
.hljs-built_in,.hljs-class .hljs-title{color:#9a6a01;color:var(--hue-6-2,#9a6a01)}
.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801;color:var(--hue-6,#986801)}
.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#336ae3;color:var(--hue-2,#336ae3)}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:700}
.hljs-link{text-decoration:underline}
</style>
<style>
var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#222}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#222;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}
</style>
<script id="initialUserConfig" type="application/json">{
  "specStatus": "DNOTE",
  "noRecTrack": true,
  "shortName": "string-meta",
  "copyrightStart": "2017",
  "edDraftURI": "https://w3c.github.io/string-meta/",
  "editors": [
    {
      "name": "Richard Ishida",
      "mailto": "ishida@w3.org",
      "company": "W3C",
      "w3cid": 3439,
      "url": "mailto:ishida@w3.org"
    },
    {
      "name": "Addison Phillips",
      "mailto": "addisonI18N@gmail.com",
      "company": "Invited Expert",
      "w3cid": 33573,
      "url": "mailto:addisonI18N@gmail.com"
    }
  ],
  "group": "i18n",
  "github": "w3c/string-meta",
  "xref": [
    "i18n-glossary"
  ],
  "localBiblio": {
    "LDML": {
      "title": "Unicode Technical Standard #35: Unicode Locale Data Markup Language (LDML)",
      "href": "https://unicode.org/reports/tr35/",
      "authors": [
        "Mark Davis",
        "CLDR Contributors"
      ],
      "id": "ldml"
    }
  },
  "publishDate": "2024-04-18",
  "publishISODate": "2024-04-18T00:00:00.000Z",
  "generatedSubtitle": "W3C Group Draft Note 18 April 2024"
}</script>
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2021/W3C-DNOTE"></head>

<body class="h-entry informative" data-cite="WEBIDL i18n-glossary"><div class="head">
    <p class="logos"><a class="logo" href="https://www.w3.org/"><img crossorigin="" alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
  </a></p>
    <h1 id="title" class="title">Strings on the Web: Language and Direction Metadata</h1> 
    <p id="w3c-state"><a href="https://www.w3.org/standards/types#DNOTE">W3C Group Draft Note</a> <time class="dt-published" datetime="2024-04-18">18 April 2024</time></p>
    <details open="">
      <summary>More details about this document</summary>
      <dl>
        <dt>This version:</dt><dd>
                <a class="u-url" href="https://www.w3.org/TR/2024/DNOTE-string-meta-20240418/">https://www.w3.org/TR/2024/DNOTE-string-meta-20240418/</a>
              </dd>
        <dt>Latest published version:</dt><dd>
                <a href="https://www.w3.org/TR/string-meta/">https://www.w3.org/TR/string-meta/</a>
              </dd>
        <dt>Latest editor's draft:</dt><dd><a href="https://w3c.github.io/string-meta/">https://w3c.github.io/string-meta/</a></dd>
        <dt>History:</dt><dd>
                    <a href="https://www.w3.org/standards/history/string-meta/">https://www.w3.org/standards/history/string-meta/</a>
                  </dd><dd>
                    <a href="https://github.com/w3c/string-meta/commits/">Commit history</a>
                  </dd>
        
        
        
        
        
        <dt>Editors:</dt><dd class="editor p-author h-card vcard" data-editor-id="3439">
    <a class="ed_mailto u-email email p-name" href="mailto:ishida@w3.org">Richard Ishida</a> (<span class="p-org org h-org">W3C</span>)
  </dd><dd class="editor p-author h-card vcard" data-editor-id="33573">
    <a class="ed_mailto u-email email p-name" href="mailto:addisonI18N@gmail.com">Addison Phillips</a> (<span class="p-org org h-org">Invited Expert</span>)
  </dd>
        
        
        <dt>Feedback:</dt><dd>
        <a href="https://github.com/w3c/string-meta/">GitHub w3c/string-meta</a>
        (<a href="https://github.com/w3c/string-meta/pulls/">pull requests</a>,
        <a href="https://github.com/w3c/string-meta/issues/new/choose">new issue</a>,
        <a href="https://github.com/w3c/string-meta/issues/">open issues</a>)
      </dd>
        
        
      </dl>
    </details>
    
    
    <p class="copyright">
    <a href="https://www.w3.org/policies/#copyright">Copyright</a>
    ©
    2017-2024
    
    <a href="https://www.w3.org/">World Wide Web Consortium</a>.
    <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup>
    <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>,
    <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and
    <a rel="license" href="https://www.w3.org/copyright/software-license-2023/" title="W3C Software and Document Notice and License">permissive document license</a> rules apply.
  </p>
    <hr title="Separator for header">
  </div>
<section id="abstract" class="introductory"><h2>Abstract</h2>
  <p>This document describes the best practices for identifying the language and direction for strings used on the Web.</p>
</section>


<div id="sotd" class="introductory"><h2>Status of This Document</h2><p><em>This section describes the status of this
      document at the time of its publication. A list of current <abbr title="World Wide Web Consortium">W3C</abbr>
      publications and the latest revision of this technical report can be found
      in the <a href="https://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports index</a> at
      https://www.w3.org/TR/.</em></p>
  <p>We welcome comments on this document, but to make it easier to track them, please raise separate issues for each comment, and point to the section you are commenting on using a URL.</p>
<p>
    This document was published by the <a href="https://www.w3.org/groups/wg/i18n-core">Internationalization Working Group</a> as
    a Group Draft Note using the
        <a href="https://www.w3.org/2023/Process-20231103/#recs-and-notes">Note track</a>. 
  </p><p>Group Draft Notes are not endorsed by
        <abbr title="World Wide Web Consortium">W3C</abbr> nor its Members. </p><p>
    This is a draft document and may be updated, replaced or obsoleted by other
    documents at any time. It is inappropriate to cite this document as other
    than work in progress.
    
  </p><p data-deliverer="32113">
    
        The
        <a href="https://www.w3.org/Consortium/Patent-Policy/"><abbr title="World Wide Web Consortium">W3C</abbr> Patent
          Policy</a>
        does not carry any licensing requirements or commitments on this
        document.
      
    
  </p><p>
                      This document is governed by the
                      <a id="w3c_process_revision" href="https://www.w3.org/2023/Process-20231103/">03 November 2023 <abbr title="World Wide Web Consortium">W3C</abbr> Process Document</a>.
                    </p></div><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>Introduction</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#conventions"><bdi class="secno">1.1 </bdi>Document Conventions</a></li><li class="tocline"><a class="tocxref" href="#terminology"><bdi class="secno">1.2 </bdi>Terminology</a></li><li class="tocline"><a class="tocxref" href="#producers_consumers"><bdi class="secno">1.3 </bdi>The String Lifecycle</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#producers"><bdi class="secno">1.3.1 </bdi>Producers</a></li><li class="tocline"><a class="tocxref" href="#consumers"><bdi class="secno">1.3.2 </bdi>Consumers</a></li><li class="tocline"><a class="tocxref" href="#agreements"><bdi class="secno">1.3.3 </bdi>Serialization Agreements</a></li></ol></li><li class="tocline"><a class="tocxref" href="#syntactic-content"><bdi class="secno">1.4 </bdi>Strings that are not <span data-cite="i18n-glossary" data-cite-path="/" data-cite-frag="dfn-localizable-text" data-type="dfn" class="formerLink">localizable text</span></a></li></ol></li><li class="tocline"><a class="tocxref" href="#bp_and-reco"><bdi class="secno">2. </bdi>Best Practices, Recommendations, and Gaps</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#serialization-best-practices"><bdi class="secno">2.1 </bdi>Recommended Serializations</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#string-specific-language"><bdi class="secno">2.1.1 </bdi>Non-Linguistic Fields</a></li><li class="tocline"><a class="tocxref" href="#single-linguistic-field"><bdi class="secno">2.1.2 </bdi>Single-Language Localizable Text Field</a></li><li class="tocline"><a class="tocxref" href="#resource_wide_default"><bdi class="secno">2.1.3 </bdi>Resource-wide Defaults</a></li><li class="tocline"><a class="tocxref" href="#language-maps"><bdi class="secno">2.1.4 </bdi>Language Maps</a></li></ol></li><li class="tocline"><a class="tocxref" href="#bp-lang-dir-unknown"><bdi class="secno">2.2 </bdi>When Language and Direction are Unknown</a></li><li class="tocline"><a class="tocxref" href="#defining_bidi_keywords"><bdi class="secno">2.3 </bdi>Defining Bidirectional Keywords in Specifications</a></li><li class="tocline"><a class="tocxref" href="#bp-writing-spec-examples"><bdi class="secno">2.4 </bdi>Writing Examples in Specifications</a></li><li class="tocline"><a class="tocxref" href="#bp-producers"><bdi class="secno">2.5 </bdi>Guidance for <span data-link-type="dfn|abstract-op" data-cite="i18n-glossary" data-cite-path="/" data-cite-frag="dfn-producer" data-type="dfn" class="formerLink">Producers</span></a></li><li class="tocline"><a class="tocxref" href="#bp-json-ld"><bdi class="secno">2.6 </bdi>Using JSON-LD</a></li><li class="tocline"><a class="tocxref" href="#protocol-strings"><bdi class="secno">2.7 </bdi>Strings that are part of a legacy protocol or format</a></li><li class="tocline"><a class="tocxref" href="#other_approaches"><bdi class="secno">2.8 </bdi>Additional Best Practices</a></li></ol></li><li class="tocline"><a class="tocxref" href="#use_cases"><bdi class="secno">3. </bdi>Requirements and Use Cases</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#problem_statement"><bdi class="secno">3.1 </bdi>Why is this important?</a></li><li class="tocline"><a class="tocxref" href="#base_example"><bdi class="secno">3.2 </bdi>An example</a></li><li class="tocline"><a class="tocxref" href="#unicode_enough"><bdi class="secno">3.3 </bdi>Isn't Unicode enough?</a></li><li class="tocline"><a class="tocxref" href="#what_consumers_do"><bdi class="secno">3.4 </bdi>What consumers need to do to support direction</a></li></ol></li><li class="tocline"><a class="tocxref" href="#bidi-approaches"><bdi class="secno">4. </bdi>Approaches Considered for Identifying the <span data-link-type="dfn|abstract-op" class="formerLink">String Direction</span></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#firststrong"><bdi class="secno">4.1 </bdi>First-strong property detection</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#how-it-works"><bdi class="secno">4.1.1 </bdi>How it works</a></li><li class="tocline"><a class="tocxref" href="#advantages"><bdi class="secno">4.1.2 </bdi>Advantages</a></li><li class="tocline"><a class="tocxref" href="#issues"><bdi class="secno">4.1.3 </bdi>Issues</a></li><li class="tocline"><a class="tocxref" href="#additional-notes"><bdi class="secno">4.1.4 </bdi>Additional notes</a></li></ol></li><li class="tocline"><a class="tocxref" href="#metadata"><bdi class="secno">4.2 </bdi> Metadata</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#how-it-works-0"><bdi class="secno">4.2.1 </bdi>How it works</a></li><li class="tocline"><a class="tocxref" href="#advantages-0"><bdi class="secno">4.2.2 </bdi>Advantages</a></li><li class="tocline"><a class="tocxref" href="#issues-0"><bdi class="secno">4.2.3 </bdi>Issues</a></li></ol></li><li class="tocline"><a class="tocxref" href="#rlm"><bdi class="secno">4.3 </bdi>Augmenting <q>first-strong</q> by inserting RLM/LRM markers</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#how-it-works-1"><bdi class="secno">4.3.1 </bdi>How it works</a></li><li class="tocline"><a class="tocxref" href="#advantages-1"><bdi class="secno">4.3.2 </bdi>Advantages</a></li><li class="tocline"><a class="tocxref" href="#issues-1"><bdi class="secno">4.3.3 </bdi>Issues</a></li></ol></li><li class="tocline"><a class="tocxref" href="#paired"><bdi class="secno">4.4 </bdi>Paired formatting characters</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#how-it-works-2"><bdi class="secno">4.4.1 </bdi>How it works</a></li><li class="tocline"><a class="tocxref" href="#advantages-2"><bdi class="secno">4.4.2 </bdi>Advantages</a></li><li class="tocline"><a class="tocxref" href="#issues-2"><bdi class="secno">4.4.3 </bdi>Issues</a></li></ol></li><li class="tocline"><a class="tocxref" href="#script_subtag"><bdi class="secno">4.5 </bdi>Script subtags</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#how-it-works-3"><bdi class="secno">4.5.1 </bdi>How it works</a></li><li class="tocline"><a class="tocxref" href="#advantages-3"><bdi class="secno">4.5.2 </bdi>Advantages</a></li><li class="tocline"><a class="tocxref" href="#issues-3"><bdi class="secno">4.5.3 </bdi>Issues</a></li><li class="tocline"><a class="tocxref" href="#other-comments"><bdi class="secno">4.5.4 </bdi>Other comments</a></li></ol></li><li class="tocline"><a class="tocxref" href="#html-content"><bdi class="secno">4.6 </bdi>Require bidi markup for content</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#html-content-how"><bdi class="secno">4.6.1 </bdi>How it works</a></li><li class="tocline"><a class="tocxref" href="#html-content-advantages"><bdi class="secno">4.6.2 </bdi>Advantages</a></li><li class="tocline"><a class="tocxref" href="#html-content-issues"><bdi class="secno">4.6.3 </bdi>Issues</a></li></ol></li><li class="tocline"><a class="tocxref" href="#dir-approach-new-datatype"><bdi class="secno">4.7 </bdi>Create a new bidi datatype</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#dir-approach-new-datatype-how"><bdi class="secno">4.7.1 </bdi>How it works</a></li><li class="tocline"><a class="tocxref" href="#advantages-5"><bdi class="secno">4.7.2 </bdi>Advantages</a></li><li class="tocline"><a class="tocxref" href="#issues-5"><bdi class="secno">4.7.3 </bdi>Issues</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#language-approaches"><bdi class="secno">5. </bdi>Approaches Considered for Identifying the Language of Content</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#language-metadata"><bdi class="secno">5.1 </bdi>Metadata</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#localizable-dictionary-how"><bdi class="secno">5.1.1 </bdi>How it works</a></li><li class="tocline"><a class="tocxref" href="#localizable-dictionary-advantages"><bdi class="secno">5.1.2 </bdi>Advantages</a></li><li class="tocline"><a class="tocxref" href="#localizable-dictionary-issues"><bdi class="secno">5.1.3 </bdi>Issues</a></li></ol></li><li class="tocline"><a class="tocxref" href="#html-content-lang"><bdi class="secno">5.2 </bdi>Require markup for content</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#html-content-lang-how"><bdi class="secno">5.2.1 </bdi>How it works</a></li><li class="tocline"><a class="tocxref" href="#html-content-lang-advantages"><bdi class="secno">5.2.2 </bdi>Advantages</a></li><li class="tocline"><a class="tocxref" href="#html-content-lang-issues"><bdi class="secno">5.2.3 </bdi>Issues</a></li></ol></li><li class="tocline"><a class="tocxref" href="#unicodeTags"><bdi class="secno">5.3 </bdi>Use Unicode language tag characters</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#unicode-tags-how"><bdi class="secno">5.3.1 </bdi>How it works</a></li><li class="tocline"><a class="tocxref" href="#unicode-tag-advantages"><bdi class="secno">5.3.2 </bdi>Advantages</a></li><li class="tocline"><a class="tocxref" href="#unicode-tag-issues"><bdi class="secno">5.3.3 </bdi>Issues</a></li></ol></li><li class="tocline"><a class="tocxref" href="#language-detection"><bdi class="secno">5.4 </bdi>Use a language detection heuristic</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#language-detection-how"><bdi class="secno">5.4.1 </bdi>How it works</a></li><li class="tocline"><a class="tocxref" href="#language-detection-advantages"><bdi class="secno">5.4.2 </bdi>Advantages</a></li><li class="tocline"><a class="tocxref" href="#language-detection-issues"><bdi class="secno">5.4.3 </bdi>Issues</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#localization-considerations"><bdi class="secno">6. </bdi>Localization Considerations</a></li><li class="tocline"><a class="tocxref" href="#use-the-localizable-data-structure"><bdi class="secno">A. </bdi>The Localizable WebIDL Dictionary</a></li><li class="tocline"><a class="tocxref" href="#Acknowledgements"><bdi class="secno">B. </bdi>Acknowledgements</a></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">C. </bdi>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#informative-references"><bdi class="secno">C.1 </bdi>Informative references</a></li></ol></li></ol></nav>

<section id="introduction-0"><div class="header-wrapper"><h2 id="introduction"><bdi class="secno">1. </bdi>Introduction</h2><a class="self-link" href="#introduction" aria-label="Permalink for Section 1."></a></div>


<p>This document was developed as a result of observations by the Internationalization Working Group over a series of specification  reviews related to formats based on JSON, WebIDL, and other non-markup data languages. Unlike markup formats, such as XML, these data languages generally do not provide extensible attributes and were  not conceived with built-in language or direction metadata.</p>

<p>The concepts in this document are applicable any time strings are used on the Web, either as part of a formalised data structure, but also where they simply originate from JavaScript scripting or any stored list of strings.</p>

<p><a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-natural-language">Natural language</a> information on the Web depends on and benefits from the presence of language and direction metadata. Along with support for Unicode, mechanisms for including and specifying the <a href="#dfn-block-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-block-direction-1">block direction</a> and the <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-natural-language">natural language</a> of spans of text are one of the key internationalization considerations when developing new formats and technologies for the Web.</p>

<p>Markup formats, such as HTML and XML, as well as related styling languages, such as CSS and XSL, are reasonably mature and provide support for the interchange and presentation of the world's languages via built-in features. Strings and string-based data formats need similar mechanisms in order to ensure complete and consistent support for the world's languages and cultures.</p>

<section id="conventions"><div class="header-wrapper"><h3 id="x1-1-document-conventions"><bdi class="secno">1.1 </bdi>Document Conventions</h3><a class="self-link" href="#conventions" aria-label="Permalink for Section 1.1"></a></div>
	
	
<p>In this document [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] keywords in uppercase italics have their usual meaning. We also use these stylistic conventions:</p>

<p class="definition-example"><strong>Definitions</strong> appear with a different background color and decoration like this.</p>
<p class="advisement"><strong>Best practices</strong> appear with a different background color and decoration like this.</p>

   

</section>

<section id="terminology"><div class="header-wrapper"><h3 id="x1-2-terminology"><bdi class="secno">1.2 </bdi>Terminology</h3><a class="self-link" href="#terminology" aria-label="Permalink for Section 1.2"></a></div>


<p>This section provides short definitions of key terminology necessary to understand the contents of this document. Most of the terms found here are taken from the [<cite><a class="bibref" data-link-type="biblio" href="#bib-i18n-glossary" title="Internationalization Glossary">I18N-GLOSSARY</a></cite>]: they are repeated here for convenience.</p>

<div class="note" role="note" id="issue-container-generatedID"><div role="heading" class="note-title marker" id="h-note" aria-level="4"><span>Note</span></div><p class="">If you are unfamiliar with bidirectional or right-to-left text, there is a basic introduction <a href="https://www.w3.org/International/articles/inline-bidi-markup/uba-basics">here</a>. This will give you a basic grasp of how the <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-unicode-bidi-algorithm">Unicode Bidirectional Algorithm</a> works and the interplay between it and the <a href="#dfn-block-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-block-direction-2">block direction</a>, which will stand you in good stead for reading this document. Additional materials can be found in the Internationalization Working Group's <a href="https://www.w3.org/TR/international-specs/#text_direction">Best Practices for Spec Developers</a>.</p></div>

<p class="definition"><a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-metadata">Metadata</a> is data <em>about</em> data: it is information included in a data structure that provides additional context, meaning, or presentation. In this document, the function of metadata is to express information about direction and language. [<cite><a class="bibref" data-link-type="biblio" href="#bib-i18n-glossary" title="Internationalization Glossary">I18N-GLOSSARY</a></cite>]</p>

<p class="definition">A <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> is any process where natural language string data is created for later storage, processing, or interchange. [<cite><a class="bibref" data-link-type="biblio" href="#bib-i18n-glossary" title="Internationalization Glossary">I18N-GLOSSARY</a></cite>]</p>

<p class="definition">A <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumer</a> is any process that receives natural language strings, either for display or processing. [<cite><a class="bibref" data-link-type="biblio" href="#bib-i18n-glossary" title="Internationalization Glossary">I18N-GLOSSARY</a></cite>]</p>

<p class="definition">A <a href="#dfn-agreement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-agreement-1">serialization agreement</a> is the common understanding between a producer and consumer about the serialization of string metadata: how it is to be understood, serialized, read, transmitted, removed, etc. [<cite><a class="bibref" data-link-type="biblio" href="#bib-i18n-glossary" title="Internationalization Glossary">I18N-GLOSSARY</a></cite>]</p>


<p>The <cite>Unicode Bidirectional Algorithm</cite> [<cite><a class="bibref" data-link-type="biblio" href="#bib-uax9" title="Unicode Bidirectional Algorithm">UAX9</a></cite>], also known as <em>UBA</em>, defines the concept of a <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-paragraph-direction">paragraph direction</a>. This is the initial base direction of a "paragraph", and resolves to either <em>left-to-right</em> or <em>right-to-left</em>. The term "paragraph" has a specific meaning internal to UBA. In the context of this document, the term is misleading, because generally strings and other data on the Web are not "paragraphs of text" in some document format. In this document, we generally use the following two more specific terms:</p>

<p class="definition" data-defines="#dfn-block-direction"><dfn id="dfn-block-direction" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">Block direction</dfn>. The initial base direction of a block of text, which resolves to either <em>left-to-right</em> or <em>right-to-left</em>. A block refers to a unit of text as a whole, such as a paragraph in a document or a string in a data file. The name "block" is chosen as a contrast to <em>inline direction</em>. Unicode calls this value the <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-paragraph-direction">paragraph direction</a>. [<cite><a class="bibref" data-link-type="biblio" href="#bib-i18n-glossary" title="Internationalization Glossary">I18N-GLOSSARY</a></cite>]</p>

<p class="definition" data-defines="#dfn-string-direction"><dfn id="dfn-string-direction" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">String direction</dfn>. The overall direction of a specific string, which indicates the presentation order of string-internal directional runs. Strings transmitted inside various data structures are often inserted into a block (such as a paragraph). In such a case, the string direction is needed as part of the <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-bidi-isolation">bidi isolation</a> of the string.</p>

<p>In this document we are concerned with identifying the <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-1">string direction</a> of a whole string and how to transmit and apply the string direction when displaying strings in various contexts. We do not talk about how to determine the direction or display of runs of text within a string.</p>

<p>The <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-unicode-bidi-algorithm">bidi algorithm</a> is primarily focused on arranging adjacent characters, based on character properties. The <a href="#dfn-block-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-block-direction-3">block direction</a> dictates (a) the visual order and direction in which runs of strongly-typed <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-left-to-right">LTR</a> and <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-right-to-left">RTL</a> characters are displayed, and (b) where there are weakly-directional or neutral characters, such as punctuation, the placement of those items relative to the other content.</p>

</section>
 
 <section id="producers_consumers"><div class="header-wrapper"><h3 id="x1-3-the-string-lifecycle"><bdi class="secno">1.3 </bdi>The String Lifecycle</h3><a class="self-link" href="#producers_consumers" aria-label="Permalink for Section 1.3"></a></div>
  
  
  <p>It's not possible to consider alternatives for handling string metadata in a vacuum: we need to establish a framework for talking about string handling and data formats.</p>
  
<section id="producers"><div class="header-wrapper"><h4 id="x1-3-1-producers"><bdi class="secno">1.3.1 </bdi>Producers</h4><a class="self-link" href="#producers" aria-label="Permalink for Section 1.3.1"></a></div>  
    
  <p>A string can be created in a number of ways, including a content author typing strings into a plain text editor, text message, or editing tool; or a script scraping text from web pages; or acquisition of an existing set of strings from another application or repository. In the data formats under consideration in this document, many strings come from back end data repositories or databases of various kinds. Sources of strings may provide an interface, API, or metadata that includes information about the <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-2">string direction</a> and language of the data. Some also provide a suitable default for when the direction or language is not provided or specified. In this document, the <b class="newterm">producer</b> of a string is the source, be it a human or a mechanism, that creates or provides a string for storage or transmission.</p>
  <p>When a  string is created, it's necessary to (a) detect or capture the appropriate language and <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-3">string direction</a> to be associated with the string, and (b) take steps, where needed, to set the string up in a way that stores and communicates the language and <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-4">string direction</a>.</p>
  <p>For example, in the case of a string that is extracted from an HTML form, the <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-5">string direction</a> can be detected from the computed value of the form's field. Such a value could be inherited from an earlier element, such as the <code class="kw" translate="no">html</code> element, or set using markup or styling on the <code class="kw" translate="no">input</code> element itself. The user could also set the direction of the text by <a href="https://www.w3.org/International/questions/qa-html-dir#userexplicit">using  keyboard shortcut keys</a> to change the direction of the form field. The <code class="kw" translate="no">dirname</code> attribute provides a way of automatically communicating that value with a form submission.</p>
  <p>Similarly, language information in an HTML form  would typically be inherited from the <code class="kw" translate="no">lang</code> attribute on the <code class="kw" translate="no">html</code> tag, or an ancestor element in the tree with a <code class="kw" translate="no">lang</code> attribute.</p>
  <p>If the producer of the string is receiving the string from a location where it was stored by another producer, and where the <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-6">string direction</a> and language has already been established, the producer needs to understand that the language and string direction has already been set, and understand how to convert or encode that information for its consumers.</p>
</section>


<section id="consumers"><div class="header-wrapper"><h4 id="x1-3-2-consumers"><bdi class="secno">1.3.2 </bdi>Consumers</h4><a class="self-link" href="#consumers" aria-label="Permalink for Section 1.3.2"></a></div>
  
  <p>A <b class="newterm">consumer</b> is an application or process that receives a string for processing and possibly places it into a context where it will be exposed to a user. For display purposes, it must ensure that the <a href="#dfn-block-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-block-direction-4">block direction</a> and language of the string is correctly applied to the string in that context. For processing purposes, it must at least persist the language and direction and may need to use the language and direction data in order to perform language-specific operations.</p>
  <p>Proper display of the string involves supplying the <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-7">string direction</a> and language to the rendering document or process by applying additional markup, adding control codes, or setting display properties. This indicates to rendering software the <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-8">string direction</a> or language that should be applied to the string in this display context to get the string to appear correctly. For both language and direction, it must make clear the boundaries for the range of text to which the language applies. For text direction, it must also isolate embedded strings from the surrounding text to avoid spill-over effects of the bidi algorithm [<cite><a class="bibref" data-link-type="biblio" href="#bib-uax9" title="Unicode Bidirectional Algorithm">UAX9</a></cite>].</p>
  <p>Note that a consumer of one document format might be a <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> of another document format.</p>
</section>


<section id="agreements"><div class="header-wrapper"><h4 id="x1-3-3-serialization-agreements"><bdi class="secno">1.3.3 </bdi>Serialization Agreements</h4><a class="self-link" href="#agreements" aria-label="Permalink for Section 1.3.3"></a></div>
  
  <p>Between any <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> and <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumer</a>, there needs to be an <dfn data-lt="agreement|serialization agreement" data-plurals="serialization agreements" id="dfn-agreement" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">agreement</dfn> about what the document format contains and what the data in each field or attribute means. Any time a producer of a string takes special steps to collect and communicate information about the <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-9">string direction</a> or language of that string, it must do so with the expectation that the consumer of the string will understand how the producer encoded this information. </p>
  <p>If no action is taken by the producer, the consumer must still decide what rules to follow in order to decide on the appropriate <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-10">string direction</a> and language, even if it is only to provide some form of default value.</p>
  <p>In some systems or document formats, the necessary behaviour of the producers and consumers of a string are fully specified. In others, such agreements are not available; it is up to users to provide an agreement for how to encode, transmit, and later decode the necessary language or direction information. Low level specifications, such as JSON, do not provide a string metadata structure by default, so any document formats based on these need to provide the "agreement" themselves.</p>
</section>
</section>

<section id="syntactic-content"><div class="header-wrapper"><h3 id="x1-4-strings-that-are-not-localizable-text"><bdi class="secno">1.4 </bdi>Strings that are not <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a></h3><a class="self-link" href="#syntactic-content" aria-label="Permalink for Section 1.4"></a></div>


<p>The Web uses strings and character sequences to encode most data. Leaving aside different data types (such as numbers, time values, or binary data serializations such as <code>base64</code>), there are still values that are defined as using a string data type but which are not intended for use as <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-natural-language">natural language</a> data values. For example, the <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-syntactic-content">syntactic content</a> defined by a specification, such as the reserved keywords in CSS or the names of the various definitions in a WebIDL document, are not part of the <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a> of their respective document formats or protocols.</p>

<p>Many specifications also allow users to provide <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-user-supplied-value">user-supplied values</a> inside of a given namespace or document format. For example, SSIDs on a Wifi network are user-defined. So too are class names in a CSS stylesheet. Most specifications allow (and are encouraged to allow) a wide range of Unicode characters in these names. Most users choose values that are recognizable as words in one or another natural language, as doing so makes the values easier to work with. However, even though these strings consist of words in a natural language, these types of strings are not considered <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a> and do not need to be encumbered with additional metadata related to language or <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-11">string direction</a>. Usually they are merely identifiers that enable a computer to match the values.</p>

<p>A sometimes-useful test is that if replacing the identifier with an arbitrary string such as <code>tK0001.37B</code> would still be allowed, functional, and "normal", then it's not <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a>.</p>

<p>For example, in the <a href="#base_example">base example</a> below, all of the keys in the JSON document (<code>id</code>, <code>title</code>, <code>authors</code>, <code>language</code>, <code>publisher</code>, and  so on) are syntactic content. The data values, such as the ISBN, the language tag, and the publication date are also syntactic content. Only the actual book title, the author's name, and the publisher's name are natural language data values and thus <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a>.</p>
</section>
</section> 

<section id="best-practices-recommendations-and-gaps"><div class="header-wrapper"><h2 id="bp_and-reco"><bdi class="secno">2. </bdi>Best Practices, Recommendations, and Gaps</h2><a class="self-link" href="#bp_and-reco" aria-label="Permalink for Section 2."></a></div>

<p>This section consists of the Internationalization (I18N) Working Group's set of best practices for identifying language and <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-12">string direction</a> in data formats on the Web. In some cases, there are gaps in existing standards, where the recommendations of the I18N WG require additional standardization or there might be barriers to full adoption.</p>

<p>The main issue is how to establish a common <a href="#dfn-agreement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-agreement-2">serialization agreement</a> between producers and consumers of data values so that each knows how to encode, find, and interpret the language and <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-13">string direction</a> of each data field. The use of metadata for supplying both the language and <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-14">string direction</a> of natural language string fields ensures that the necessary information is present, can be supplied and extracted with the minimal amount of processing, and does not require producers or consumers to scan or alter the data.</p>

<p>The most basic best practice, which the Internationalization Working Group looks for in every specification, is:</p>

<div class="req" id="bp-determine"><a href="#bp-determine" class="self-link">§</a>
	<p class="advisement">For any string field containing natural language text, it <em class="rfc2119">MUST</em> be possible to determine the language and <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-15">string direction</a> of that specific string. Such determination <em class="rfc2119">SHOULD</em> use metadata at the string or document level and <em class="rfc2119">SHOULD NOT</em> depend on heuristics.</p>
</div>

<section id="recommended-serializations"><div class="header-wrapper"><h3 id="serialization-best-practices"><bdi class="secno">2.1 </bdi>Recommended Serializations</h3><a class="self-link" href="#serialization-best-practices" aria-label="Permalink for Section 2.1"></a></div>
	

		  <p>This section describes four approaches to serialization for string values. Specifications are intended to use these together to form a complete solution to managing language and direction metadata in document formats and protocols.</p>
		  
		  <section id="non-linguistic"><div class="header-wrapper"><h4 id="string-specific-language"><bdi class="secno">2.1.1 </bdi>Non-Linguistic Fields</h4><a class="self-link" href="#string-specific-language" aria-label="Permalink for Section 2.1.1"></a></div>
		  
		  
		  <p>Avoid assigning or requiring language or direction metadata for <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-non-linguistic-field">non-linguistic fields</a> (that is, strings that contain data that is not human language). Note that this includes <a href="https://www.w3.org/TR/international-specs/#application_internal">application-internal data values</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-international-specs" title="Internationalization Best Practices for Spec Developers">INTERNATIONAL-SPECS</a></cite>].</p>
		  
          <p>While the value of a <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-syntactic-content">syntactic content</a> item or <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-user-supplied-value">user-supplied value</a> will often use a word-like token that conveys meaning to humans (as an aid in debugging, for example), the values need to consistently be wrapped with localizable display strings for presentation to the user.</p>

           <div class="req" id="bp-do_not_use_language_non_data"><a href="#bp-do_not_use_language_non_data" class="self-link">§</a>
	          <p class="advisement">Specifications <em class="rfc2119">SHOULD NOT</em> specify or require the use of language metadata for <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-syntactic-content">syntactic content</a> or for the value of fields that cannot contain natural language text.</p>
          </div>

          <div class="note" role="note" id="issue-container-generatedID-0"><div role="heading" class="note-title marker" id="h-note-0" aria-level="5"><span>Note</span></div><aside class="">
             <p>Error messages are not <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-syntactic-content">syntactic content</a>. They consist of and need to be treated as <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a>.</p>
          </aside></div>
			  
		  <div class="req" id="bp-non-linguistic-defaults"><a href="#bp-non-linguistic-defaults" class="self-link">§</a>
		     <p class="advisement">If a <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumer</a> is required to assign a language tag to some non-linguistic data, the language tag <code>zxx</code> (Non-Linguistic) <em class="rfc2119">SHOULD</em> be used. If a <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumer</a> is required to assign a <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-16">string direction</a> to such data, the value <code>auto</code> <em class="rfc2119">SHOULD</em> be used.</p>
		  </div>
		  
  
		  <aside class="example" id="example-examples-of-non-linguistic-string-values"><div class="marker">
    <a class="self-link" href="#example-examples-of-non-linguistic-string-values">Example<bdi> 1</bdi></a><span class="example-title">: Examples of non-linguistic string values</span>
  </div>
			  <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"isbn"</span>: <span class="hljs-string">"978-123456789-X"</span>,
<span class="hljs-string">"part-number"</span>: <span class="hljs-string">"§ABC-123-0094"</span></code></pre>
			  
			  <p>Note that non-linguistic values are sometimes <em>localized</em>, even though they are not <em>translated</em>.</p>
			  <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"gaining-value-color"</span>: <span class="hljs-string">"green"</span>, <span class="hljs-comment">// perhaps "red" in another locale?</span>
<span class="hljs-string">"background-color"</span>: <span class="hljs-string">"#ffebdd"</span>,  <span class="hljs-comment">// or something else?</span>
<span class="hljs-string">"default-level"</span>: <span class="hljs-string">"medium"</span>,      <span class="hljs-comment">// perhaps "large" or "small" in another locale?</span>
<span class="hljs-string">"help-file-url"</span>: <span class="hljs-string">"https://example.org/en-US/help.html"</span></code></pre>
		  </aside>
		  

			  
          <div class="req" id="bp_separate_localizable"><a href="#bp_separate_localizable" class="self-link">§</a>
             <p class="advisement">Specifications <em class="rfc2119">SHOULD</em> be careful to distinguish <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-syntactic-content">syntactic content</a>, including <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-user-supplied-value">user-supplied values</a>, from <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a>.</p>
          </div>

          <div class="req" id="bp_non_displayable_syntactic"><a href="#bp_non_displayable_syntactic" class="self-link">§</a>
             <p class="advisement">Specifications <em class="rfc2119">MUST NOT</em> treat <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-syntactic-content">syntactic content</a> values as "displayable".</p>
          </div>
		  </section>
		  
<section id="single-linguistic-field"><div class="header-wrapper"><h4 id="x2-1-2-single-language-localizable-text-field"><bdi class="secno">2.1.2 </bdi>Single-Language Localizable Text Field</h4><a class="self-link" href="#single-linguistic-field" aria-label="Permalink for Section 2.1.2"></a></div>
		   
			  
           <div class="req" id="bp_lang_field_based_metadata"><a href="#bp_lang_field_based_metadata" class="self-link">§</a>
              <p class="advisement">Use field-based metadata or string datatypes to indicate the language and the <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-17">string direction</a> for individual <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a> values.</p>
           </div>

		  <p>For <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a> fields that appear in a single language, use a data structure to represent the value. The recommended representation is an object with three fields. The field <code>value</code> contains the actual string. The field <code>lang</code> contains a <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-valid">valid</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-bcp47" title="Tags for Identifying Languages">BCP47</a></cite>] language tag. The field <code>dir</code> contains the string's <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-18">string direction</a> (one of the values <code>ltr</code>, <code>rtl</code>, and <code>auto</code>).</p>
		  
		  <aside class="example" id="example-example-of-a-localizable-text-field"><div class="marker">
    <a class="self-link" href="#example-example-of-a-localizable-text-field">Example<bdi> 2</bdi></a><span class="example-title">: Example of a localizable text field</span>
  </div>
		  <pre class="json" id="localizable-text-field" aria-busy="false"><code class="hljs">"field-name-goes-here": {
    "value": "This is the string value",
    "lang": "en-US",
    "dir": "ltr"
}</code></pre>
		  </aside>

          <p>Use of heuristics to determine language or <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-19">string direction</a> will always fail for certain cases, and there needs to be a way to provide the correct outcome for those strings. Assignment of <a href="#metadata">metadata</a> (either as a resource-wide default, or in a string-specific label) is an intentional act that removes the need to guess the outcome by applying heuristics.</p>

          <p>The use of <a href="#metadata">metadata</a> for indicating <a href="#dfn-block-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-block-direction-5">block direction</a> is preferred because it avoids requiring the consumer to interpolate the direction using methods such as <a href="#firststrong">first strong</a> or use of methods which require modification of the data itself (such as the <a href="#rlm">insertion of RLM/LRM markers</a> or <a href="#paired">bidirectional controls</a>).</p>

<div class="note" role="note" id="issue-container-generatedID-1"><div role="heading" class="note-title marker" id="h-note-1" aria-level="5"><span>Note</span></div><aside class="">
    <p>Some schema languages, such as the RDF suite of specifications, have no built-in mechanism for associating <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-20">string direction</a> metadata with natural language string values. It is up to specifications that use these specifications to define structures and adopt best practices that result in clean interchange of language and direction metadata.</p>
    <p>For example, [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>] provides a document-level <a data-link-type="dfn|abstract-op" href="#dfn-block-direction" class="internalDFN" id="ref-for-dfn-block-direction-6">block direction</a> using the <code class="kw" translate="no">@context</code> mechanism and defines the <code class="kw" translate="no">i18n</code> namespace as an extension of existing RDF datatypes which can be used to set the language, <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-21">string direction</a>, or both of string values.</p>
</aside></div>


<div class="req" id="bp_localizable"><a href="#bp_localizable" class="self-link">§</a>
<p class="advisement">For [<cite><a class="bibref" data-link-type="biblio" href="#bib-webidl" title="Web IDL Standard">WebIDL</a></cite>]-defined data structures, define each <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a> (natural language text) field as a <q><a href="#Localizable" class="internalDFN" data-link-type="idl" id="ref-for-Localizable-1"><code>Localizable</code></a></q>.</p>
</div>

<p> This combines both language and direction metadata and, if consistently adopted, makes interchange between different formats easier. Consistency between different specifications and document formats allows for the easy interchange of string data. By naming field attributes in the same way and adopting the same semantics, different specifications can more easily extract values from or add values into resources from other data sources.</p>

	</section>
		  
	<section id="language-defaults"><div class="header-wrapper"><h4 id="resource_wide_default"><bdi class="secno">2.1.3 </bdi>Resource-wide Defaults</h4><a class="self-link" href="#resource_wide_default" aria-label="Permalink for Section 2.1.3"></a></div>
	
			  
	<p>When a resource contains a number of natural language strings (and particularly if those string are all in the same language), using the localized string representation described above can become inefficient. To reduce the complexity of encoding these strings, specifications can establish a resource-level default for language and <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-22">string direction</a>. These are separate values, as language does not imply direction. There should still be the ability to override either language or direction on any given string value by using the representation found <a href="#single-linguistic-field">above</a>.</p>
	
	<p class="definition" data-defines="#dfn-resource-wide-default">A <dfn data-lt="resource-wide default|document-level default" id="dfn-resource-wide-default" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">resource-wide default</dfn> is a value that is specified at the resource or document-level and can be applied to any unlabeled value contained by that resource.</p>
			  
	 <div class="req" id="bp_default_setting"><a href="#bp_default_setting" class="self-link">§</a>
        <p class="advisement">Specifications <em class="rfc2119">MAY</em> define a mechanism to provide the default language and the default <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-23">string direction</a> for all strings in a given resource. However, specifications <em class="rfc2119">MUST NOT</em> assume that a resource-wide default is sufficient.  Even if a resource-wide setting is available, it must be possible to use string-specific metadata to override that default.</p>
     </div>

	 <p>If your specification defines its own document level defaults, provide two optional fields:</p>
			  
	 <div class="req" id="bp-document-language-default"><a href="#bp-document-language-default" class="self-link">§</a>
		<p class="advisement">A resource-wide default language field <em class="rfc2119">SHOULD</em> be called <code>language</code> and <em class="rfc2119">SHOULD</em> be specified to contain a <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-valid">valid</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-bcp47" title="Tags for Identifying Languages">BCP47</a></cite>] language tag. Specifications <em class="rfc2119">SHOULD</em> specify that implementations are only require to check if a [<cite><a class="bibref" data-link-type="biblio" href="#bib-bcp47" title="Tags for Identifying Languages">BCP47</a></cite>] language tag is <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-well-formed">well-formed</a>.</p>
	 </div>
     <div class="req" id="bp-document-direction-default"><a href="#bp-document-direction-default" class="self-link">§</a>
		<p class="advisement">A resource-wide default <a href="#dfn-block-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-block-direction-7">block direction</a> field <em class="rfc2119">SHOULD</em> be called <code>direction</code> and support the values <code>ltr</code>, <code>rtl</code>, or <code>auto</code>.</p>
	</div>

    <aside class="example" id="example-example-of-document-level-defaults"><div class="marker">
    <a class="self-link" href="#example-example-of-document-level-defaults">Example<bdi> 3</bdi></a><span class="example-title">: Example of document level defaults</span>
  </div>
    <pre class="json" aria-busy="false"><code class="hljs">"language": "en-US",
"direction": "ltr",
//...
"some-field-name": "This string is in U.S. English, thanks to the default",
// the following field overrides the language but not the direction:
"another-field-name": {
   "value": "Diese Zeichenfolge ist auf Deutsch",
   "lang": "de"
}</code></pre>
    </aside>

    <p>Exceptions to the default are always a possibility, so it needs to be possible for users to override the default on a string-by-string basis.</p>

    <p>First-strong heuristics are not applied to strings when the direction has been set externally using metadata. Even if a strongly directional character, such as <span class="codepoint" translate="no"><img alt="RLM" src="images/200F.png"><code class="uname">U+200F RIGHT-TO-LEFT MARK</code></span>, has been prepended to a string, resource-wide default metadata can override the presentation of the string in ways that result in <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-spillover-effects">spillover</a> effects. Therefore content needs to be able to provide string-level metadata to override the default for strings whose <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-24">string direction</a> does not match the resource-wide default.</p>
		  
	<p>For specifications that can make use of the [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>] <code>@context</code> mechanism, use the <code>@language</code> and <code>@direction</code> fields to supply the document level defaults.</p>
              
    <div class="note" role="note" id="issue-container-generatedID-2"><div role="heading" class="note-title marker" id="h-note-2" aria-level="5"><span>Note</span></div><aside class="">
		<p><strong>Document level defaults are not a complete solution on their own.</strong> Specifications can define a document-level defaulting mechanism to assist users who often create monolingual documents. However, specifications should only use document-level defaults to augment the ability for users to provide string-specific metadata.</p>
    </aside></div>
	</section>
		  
		  
		  <section id="language-maps"><div class="header-wrapper"><h4 id="x2-1-4-language-maps"><bdi class="secno">2.1.4 </bdi>Language Maps</h4><a class="self-link" href="#language-maps" aria-label="Permalink for Section 2.1.4"></a></div>
		  
		  
		  <p>The world is not monolingual. Having documents that contain only a single language would mean providing many iterations of the document, one for each language, in order to localize the content. This also might require language negotiation when requesting the content.</p>
		  
		  <p>One way to address this is to allow multilingual values for each <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a> field inside the document.</p>
		  
		  <p>Language selection is not merely the exact matching of language tag string values to the user's preferred locale. The usual <a href="#localizable-text-field">object representation</a> of a <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a> field requires that the object be deserialized in order to discover the language tag associated with the value. This can be inefficient when there are many values in a given file. In these cases, the best practice is to use a language map to organize <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a> values. Such a map exposes the language tag for the purposes of selection, but still uses an object representation on the value side of the map, since both language and direction might need to be overridden for a given string value.</p>
		  
		  <div class="note" role="note" id="issue-container-generatedID-3"><div role="heading" class="note-title marker" id="h-note-3" aria-level="5"><span>Note</span></div><aside class="">
			  <p>The language map structure presented in this section is not the same as the language maps found in <a href="https://www.w3.org/TR/json-ld/#string-internationalization">JSON-LD String Internationalization</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>].</p>
		  </aside></div>
		  
		  
		  <aside class="example" id="example-a-localizable-language-map"><div class="marker">
    <a class="self-link" href="#example-a-localizable-language-map">Example<bdi> 4</bdi></a><span class="example-title">: A localizable language map</span>
  </div>
		  <pre class="json" aria-busy="false"><code class="hljs">"field-name-goes-here": {
    "en":    {"value": "This is English"},
    "en-GB": {"value": "This is UK English", "dir": "ltr"},
    "fr":    {"value": "C'est français", "lang": "fr-CA", "dir": "ltr"},
    "ar":    {"value": "هذه عربية", "dir": "rtl"}
}</code></pre>
		  </aside>
		  
		  <div class="note" role="note" id="issue-container-generatedID-4"><div role="heading" class="note-title marker" id="h-note-4" aria-level="5"><span>Note</span></div><aside class="">
			  <p>This structure permits a language tag as the key and also as part of the value. These two values do not have to match. The value of the key indicates the <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-locale">locale</a> of the intended audience, while the language tag of the value represents information about the actual language of the string.</p>
			  <p>These values might not match in cases where additional specificity is needed to get the correct rendering or processing of the value or, occasionally, when a foreign language value <strong><em>is</em></strong> the intended localization (and the language needs to be overridden, such as to select voices or dictionaries in assistive technology):</p>
			  <pre class="json" aria-busy="false"><code class="hljs">"extra-rendering-help": {
	"zh": {"value": "你好世界！", "lang": "zh-Hans"}
}
				  
"hello-in-french": {
	"en": {"value": "Bonjour!", "lang": "fr"},
	"de": {"value": "Bonjour!", "lang": "fr"}
}</code></pre>
		  </aside></div>
		  </section>
		  
      </section>

<section id="when-language-and-direction-are-unknown"><div class="header-wrapper"><h3 id="bp-lang-dir-unknown"><bdi class="secno">2.2 </bdi>When Language and Direction are Unknown</h3><a class="self-link" href="#bp-lang-dir-unknown" aria-label="Permalink for Section 2.2"></a></div>


<div class="req" id="bp_default_fallback"><a href="#bp_default_fallback" class="self-link">§</a>
<p class="advisement">Specify that, in the absence of other information, the default direction and default language are unknown.</p>
</div>

<p>Explicit metadata, if available, trumps the need for heuristics to be applied.  This is logical, since the heuristic method cannot reliably deduce the necessary direction on its own, and if metadata has been explicitly provided there is an indication that it is intended to be authoritative.
</p>
<p>It is essential for a consumer to know that language and direction are unknown quantities in order for them to know when to apply fallback strategies to the data (this could include language-detection, or first-strong heuristics for direction).  In particular, the default direction should not be set to LTR, since that would override the need for first-strong detection, which is more appropriate for strings written in a RTL script.</p>
</section>

<div class="req" id="bp_use_heuristics_1"><a href="#bp_use_heuristics_1" class="self-link">§</a>
<p class="advisement">For the case where the <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-25">string direction</a> is not known, specify that consumers should use first-strong heuristics to identify the <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-26">string direction</a> of each string.</p>
</div>

<p>If&nbsp;metadata is not available, consumers of strings should use heuristics, preferably based on the Unicode Standard's first-strong detection algorithm, to detect the base direction of a string.</p>
<p>The <a href="#firststrong">first-strong algorithm</a> looks for the first strongly-directional character in a string (skipping certain preliminary substrings), and assumes that it represents the <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-27">string direction</a> of the string as a whole. However, the first strong directional character doesn't always coincide with the actual or desired <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-28">string direction</a> of the string as a whole, so it should be possible to  provide metadata, where needed, to address this problem.</p>

<div class="req" id="bp_using_rlm_lrm"><a href="#bp_using_rlm_lrm" class="self-link">§</a>
<p class="advisement">If relying on first-strong heuristics, allow content developers to use RLM/LRM at the beginning of a string where it is necessary to force a particular base direction, but do not prepend one of these characters to existing strings.</p>
</div>

<div class="req" id="bp_rlm_lrm_availability"><a href="#bp_rlm_lrm_availability" class="self-link">§</a>
<p class="advisement">Do not rely on the availability of RLM/LRM formatting characters in most cases.</p>
</div>

<p>If string data is being provided by users or content developers in web forms or other simple environments, users may not be able to enter these formatting characters.  In fact, most users will probably be unaware that such characters exist, or how to use them.  A web form can render their use unnecessary for immediate inspection if it sets the <a href="#dfn-block-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-block-direction-8">block direction</a> for the input (which it should).</p>


<div class="req" id="bp_inferring_from_language"><a href="#bp_inferring_from_language" class="self-link">§</a>
<p class="advisement">Specifications <em class="rfc2119">SHOULD NOT</em> allow a <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-29">string direction</a> to be <a href="#script_subtag">interpolated from available language metadata</a> unless direction metadata is not available and cannot otherwise be provided.</p>
</div>

<p>Not all resources make use of the available metadata mechanisms. The script subtag of a language tag (or the "likely" script subtag based on [<cite><a class="bibref" data-link-type="biblio" href="#bib-bcp47" title="Tags for Identifying Languages">BCP47</a></cite>] and [<cite><a class="bibref" data-link-type="biblio" href="#bib-ldml" title="Unicode Technical Standard #35: Unicode Locale Data Markup Language (LDML)">LDML</a></cite>]) can sometimes be used to infer a <a data-link-type="dfn|abstract-op" href="#dfn-block-direction" class="internalDFN" id="ref-for-dfn-block-direction-9">block direction</a> or <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-30">string direction</a> when other data is not available. Using language information is a "last resort" and specifications <em class="rfc2119">SHOULD NOT</em> use it as the primary way of indicating <a data-link-type="dfn|abstract-op" href="#dfn-block-direction" class="internalDFN" id="ref-for-dfn-block-direction-10">block direction</a>: make the effort to provide for metadata.</p>

<section id="defining-bidirectional-keywords-in-specifications"><div class="header-wrapper"><h3 id="defining_bidi_keywords"><bdi class="secno">2.3 </bdi>Defining Bidirectional Keywords in Specifications</h3><a class="self-link" href="#defining_bidi_keywords" aria-label="Permalink for Section 2.3"></a></div>


<p>A specification for a document format or protocol that includes natural language text values will need to define a data field or attribute to store the <a href="#dfn-block-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-block-direction-11">block direction</a> for each natural language content value. These definitions need to be consistent across the Web in order to ensure interoperability, because <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumers</a> of one document format will need to map the <a href="#dfn-block-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-block-direction-12">block direction</a> for values they receive to fields that they produce or will need to control the <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-31">string direction</a> of each string when displaying the content. This section describes how to provide such a definition along with the specific content to use.</p>

<p>There are two common use cases for defining content direction: (i) defining a <a href="#dfn-directional-metadata-field" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-directional-metadata-field-1">directional metadata field</a> for storing and transmitting the <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-32">string direction</a> as a field in a data structure or (ii) defining a <a href="#dfn-direction-attribute" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-direction-attribute-1">direction attribute</a> to associate a <a href="#dfn-block-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-block-direction-13">block direction</a> with a given piece of natural language content.</p>

<p class="definition" data-defines="#dfn-directional-metadata-field"><dfn data-lt="directional metadata field|direction field|Directional metadata field" id="dfn-directional-metadata-field" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">Directional metadata field</dfn>. A directional metadata field (or <strong>direction field</strong> for short) is a field in a data structure used to associate a <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-33">string direction</a> with a given natural language string field or data value.</p>

<aside class="example" id="example-direction-metadata"><div class="marker">
    <a class="self-link" href="#example-direction-metadata">Example<bdi> 5</bdi></a>
  </div>
	<p><strong>Example of a <a href="#dfn-directional-metadata-field" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-directional-metadata-field-2">direction field</a>.</strong> In this JSON fragment, the <code>title</code> structure has a field <code>direction</code> which represents the <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-34">string direction</a> to use for the field <code>value</code>.</p>
<pre class="json" aria-busy="false"><code class="hljs">"title": {
	"value": "HTML و CSS: تصميم و إنشاء مواقع الويب",
	"direction": "rtl",
	"language": "ar"
}</code></pre>
</aside>

<p class="definition" data-defines="#dfn-direction-attribute"><dfn data-lt="direction attribute|Direction attribute" id="dfn-direction-attribute" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">Direction attribute</dfn>. A direction attribute is a field or value, usually represented by an attribute in markup languages, that provides the <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-35">string direction</a> of the associated natural language string content.</p>

<aside class="example" id="example-6"><div class="marker">
    <a class="self-link" href="#example-6">Example<bdi> 6</bdi></a>
  </div>

<p><strong>Example of a <a href="#dfn-direction-attribute" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-direction-attribute-2">direction attribute</a>.</strong> If the JSON in the <a href="#example-direction-metadata">above example</a> of a <a href="#dfn-directional-metadata-field" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-directional-metadata-field-3">directional metadata field</a> were received by a process that was assembling a Web page for display, it might fill in a template similar to the top line in this example to produce markup like the second line. Here the <code class="kw" translate="no">dir</code> attribute from [<cite><a class="bibref" data-link-type="biblio" href="#bib-html" title="HTML Standard">HTML</a></cite>] is an example of a <a href="#dfn-direction-attribute" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-direction-attribute-3">direction attribute</a>.</p>

<pre aria-busy="false"><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">dir</span>=<span class="hljs-string">"{$title.direction}"</span>&gt;</span>{$title.value}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">dir</span>=<span class="hljs-string">"rtl"</span>&gt;</span>HTML و CSS: تصميم و إنشاء مواقع الويب<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></code></pre>
	
</aside>

<div class="req" id="bp-define-field-direction-value"><a href="#bp-define-field-direction-value" class="self-link">§</a>
   <p class="advisement">Use the field name <code class="kw" translate="no">direction</code> when defining a <a href="#dfn-directional-metadata-field" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-directional-metadata-field-4">directional metadata field</a> in a data structure or protocol.</p>
</div>

<p>The name <code class="kw" translate="no">direction</code> is preferred for data values. The name <code class="kw" translate="no">dir</code> is an acceptable alternative.</p>

<div class="req" id="bp-define-display-dir-attribute"><a href="#bp-define-display-dir-attribute" class="self-link">§</a>
   <p class="advisement">Use the field name <code class="kw" translate="no">dir</code> when defining a <a href="#dfn-direction-attribute" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-direction-attribute-4">direction attribute</a>.</p>
</div>

<p>The name <code class="kw" translate="no">dir</code> is preferred for an attribute, such as in markup languages. Using <code class="kw" translate="no">direction</code> for an attribute is not recommended, since it is long and relatively uncommon for this use case. Note that both [<cite><a class="bibref" data-link-type="biblio" href="#bib-html" title="HTML Standard">HTML</a></cite>] and [<cite><a class="bibref" data-link-type="biblio" href="#bib-xml10" title="Extensible Markup Language (XML) 1.0 (Fifth Edition)">XML10</a></cite>] have a built-in <code class="kw" translate="no">dir</code> attribute. A <code class="kw" translate="no">dir</code> attribute should have scope within a document and should be defined to provide bidi isolation.</p>

<div class="req" id="bp-define-direction-values"><a href="#bp-define-direction-values" class="self-link">§</a>
   <p class="advisement">Define the values of a <a href="#dfn-directional-metadata-field" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-directional-metadata-field-5">directional metadata field</a> or a <a href="#dfn-direction-attribute" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-direction-attribute-5">direction attribute</a> to include and be limited to the values <code class="kw" translate="no">ltr</code>, <code class="kw" translate="no">rtl</code>, and <code class="kw" translate="no">auto</code>.</p>
</div>

<p>The value <code class="kw" translate="no">ltr</code> indicates a direction of left-to-right, in exactly the same manner indicated by <a href="https://www.w3.org/TR/css-writing-modes/#direction">CSS writing modes</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-css-writing-modes-4" title="CSS Writing Modes Level 4">CSS-WRITING-MODES-4</a></cite>]</p>

<p>The value <code class="kw" translate="no">rtl</code> indicates a direction of right-to-left, in exactly the same manner indicated by <a href="https://www.w3.org/TR/css-writing-modes/#direction">CSS writing modes</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-css-writing-modes-4" title="CSS Writing Modes Level 4">CSS-WRITING-MODES-4</a></cite>]</p>

<p>The value <code class="kw" translate="no">auto</code> indicates that the user agent uses the <a href="https://html.spec.whatwg.org/multipage/dom.html#the-dir-attribute">algorithm</a> for <code class="kw" translate="no">auto</code> defined by [<cite><a class="bibref" data-link-type="biblio" href="#bib-html" title="HTML Standard">HTML</a></cite>] to determine the <a data-link-type="dfn|abstract-op" href="#dfn-block-direction" class="internalDFN" id="ref-for-dfn-block-direction-14">block direction</a> ("<a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-paragraph-direction">paragraph direction</a>"). This heuristic looks for the first character with a strong directionality, in a manner analogous to the Paragraph Level determination in the bidirectional algorithm [<cite><a class="bibref" data-link-type="biblio" href="#bib-uax9" title="Unicode Bidirectional Algorithm">UAX9</a></cite>].</p>

<p>When <code class="kw" translate="no">auto</code> is applied to multiple fields or to a document as a whole, it means that the direction should be individually derived for each field (with string-specific metadata providing an override for cases that cannot be determined automatically). It can be useful for labelling a group of mixed direction strings, when the <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-36">string direction</a> of most strings can be reliably determined using the first-strong heuristics. Whenever possible, the actual <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-37">string direction</a> (<code class="kw" translate="no">ltr</code> or <code class="kw" translate="no">rtl</code>) of individual strings should be stored or exchanged instead of <code class="kw" translate="no">auto</code>. Omitting the <a href="#dfn-directional-metadata-field" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-directional-metadata-field-6">direction field</a> is preferable when the value is truly unknown.</p>

</section>

<section id="writing-spec-examples"><div class="header-wrapper"><h3 id="bp-writing-spec-examples"><bdi class="secno">2.4 </bdi>Writing Examples in Specifications</h3><a class="self-link" href="#bp-writing-spec-examples" aria-label="Permalink for Section 2.4"></a></div>


<p>Specifications for document formats or protocols typically include examples. Examples necessarily include natural language text fields. </p>

<div class="req" id="bp-use-serializations-in-examples"><a href="#bp-use-serializations-in-examples" class="self-link">§</a>
	<p class="advisement">When creating examples in a specfication, always use the serializations and best practices found in this document for fields that contain <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-natural-language">natural language</a> text. If the format or protocol supports a <a href="#resource_wide_default">resource-wide default</a>, show setting the default in the example. If the format or protocol does not support a document-level default or showing the default would be inconvenient, use a <a href="#single-linguistic-field">Single-Language Localizable Text Field</a> or <a href="#language-maps">Language Map</a> in the example.</p>
</div>

<aside class="example" id="example-examples-of-using-best-practices"><div class="marker">
    <a class="self-link" href="#example-examples-of-using-best-practices">Example<bdi> 7</bdi></a><span class="example-title">: Examples of using best practices</span>
  </div>
<p>Here is an example using a document-level default. It also shows overriding the default, in case you need to demonstrate that. Specifications do not need to include examples of such overrides when they are demonstrating specific features of the document format or protocol.</p>

<pre class="json" aria-busy="false"><code class="hljs">"@context": [
   "@language": "en",
   "@direction": "ltr"
],
"name": "Example University",
"description": "The examples 'name' and 'description' use the document-level default.",
"french-field": {
   "value": "Cet exemple est en français",
   "lang": "fr"
},
"arabic-field": {
   "value": "هذا المثال باللغة العربية",
   "lang": "ar",
   "dir": "rtl"
}</code></pre>
</aside>

</section>

<section id="guidance-for-producers"><div class="header-wrapper"><h3 id="bp-producers"><bdi class="secno">2.5 </bdi>Guidance for <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">Producers</a></h3><a class="self-link" href="#bp-producers" aria-label="Permalink for Section 2.5"></a></div>


<p>Content <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producers</a>, including implementers of specifications that provide the various language and direction metadata mechanisms described in this document, have some discretion about how to implement the best practices found here. For example, if a document format provides both a resource-wide default and single-language localizable text fields, which should a user prefer?</p>

<div class="req" id="bp-producer-resource-wide-lang"><a href="#bp-producer-resource-wide-lang" class="self-link">§</a>
	<p class="advisement">If a <a data-link-type="dfn|abstract-op" href="#dfn-resource-wide-default" class="internalDFN" id="ref-for-dfn-resource-wide-default-1">resource-wide default</a> for language is provided by a document format or protocol, it <em class="rfc2119">SHOULD</em> always be set to the language most appropriate for the contents of the document. Often this is the <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-locale">locale</a> of the generating user.</p>
</div>

<div class="req" id="bp-producer-resource-wide-dir"><a href="#bp-producer-resource-wide-dir" class="self-link">§</a>
	<p class="advisement">If a <a data-link-type="dfn|abstract-op" href="#dfn-resource-wide-default" class="internalDFN" id="ref-for-dfn-resource-wide-default-2">resource-wide default</a> for direction is provided by a document format or protocol, it <em class="rfc2119">SHOULD</em> always be set to the direction most associated with the content of the document. Usually this direction is consistent with the document-level language default, if provided.</p>
</div>

<p>For example, if the resource-wide language of a document is <code class="kw" translate="no">en-US</code> (English, United States), then the resource-wide direction of the document should probably be <code class="kw" translate="no"><a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-left-to-right">LTR</a></code>, because left-to-right is the direction associated with that language.</p>

<div class="req" id="bp-producer-omit-lang-dir"><a href="#bp-producer-omit-lang-dir" class="self-link">§</a>
	<p class="advisement"><a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">Producers</a> <em class="rfc2119">SHOULD NOT</em> include string-specific language or direction metadata if a <a data-link-type="dfn|abstract-op" href="#dfn-resource-wide-default" class="internalDFN" id="ref-for-dfn-resource-wide-default-3">resource-wide default</a> is provided and the string-specific value is consistent with that default.</p>
</div>

<div class="req" id="bp-producer-more-specific-lang"><a href="#bp-producer-more-specific-lang" class="self-link">§</a>
	<p class="advisement"><a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">Producers</a> <em class="rfc2119">SHOULD</em> include string-specific language metadata if the value for a given string is <em>more specific</em> or entirely different from that of the <a data-link-type="dfn|abstract-op" href="#dfn-resource-wide-default" class="internalDFN" id="ref-for-dfn-resource-wide-default-4">resource-wide default</a>.</p>
</div>

<p>For example, if the <a data-link-type="dfn|abstract-op" href="#dfn-resource-wide-default" class="internalDFN" id="ref-for-dfn-resource-wide-default-5">resource-wide default</a> value were <code class="kw" translate="no">fr</code> (French) and the string's associated language were <code class="kw" translate="no">fr-FR</code> (French, France), the <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> ought to generate string-specific metadata with the more specific <code class="kw" translate="no">fr-FR</code> tag. Similarly, the <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> ought to generate string-specific metadata if the language were entirely different, such as <code class="kw" translate="no">de</code> (German).</p>

<p>A <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-language-tag">language tag</a> is more-specific if it contains more subtags.</p>

<div class="note" role="note" id="issue-container-generatedID-5"><div role="heading" class="note-title marker" id="h-note-5" aria-level="4"><span>Note</span></div><aside class="">
	<p>Supporting the encoding of more-specific language tags is one reason why the <a href="#language-maps">language maps</a> stucture includes the option of overriding the language tag in the value portion of each entry. The more-specific tags can assist with processing, such as selecting the right voice in a text-to-speech system or the right dictionary when checking spelling.</p>
</aside></div>

<div class="req" id="bp-producer-include-rtl-dir"><a href="#bp-producer-include-rtl-dir" class="self-link">§</a>
	<p class="advisement"><a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">Producers</a> <em class="rfc2119">SHOULD</em> include string-specific direction metadata for any content whose <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-38">string direction</a> is opposite that of a provided <a data-link-type="dfn|abstract-op" href="#dfn-resource-wide-default" class="internalDFN" id="ref-for-dfn-resource-wide-default-6">resource-wide default</a>, even if the string itself is unambiguous.</p>
</div>

<p>Many strings consist solely of strongly directional characters that are consistent with the overall <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-39">string direction</a>. When this direction does not agree with the <a data-link-type="dfn|abstract-op" href="#dfn-resource-wide-default" class="internalDFN" id="ref-for-dfn-resource-wide-default-7">resource-wide default</a> (and the default is present), the <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-40">string direction</a> needs to be included so that <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumers</a> do not need to introspect the string to determine direction and so that processes (such as filtering and selection) do not mistake the content's direction.</p>


</section>

<section id="technology_specific_solutions"><div class="header-wrapper"><h3 id="bp-json-ld"><bdi class="secno">2.6 </bdi>Using JSON-LD</h3><a class="self-link" href="#bp-json-ld" aria-label="Permalink for Section 2.6"></a></div>


<div class="req" id="bp_use_jsonld_language_context"><a href="#bp_use_jsonld_language_context" class="self-link">§</a>
<p class="advisement">Use of [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>] <code class="kw" translate="no">@context</code> and the built-in <code class="kw" translate="no">@language</code> attribute is <em class="rfc2119">RECOMMENDED</em> as a document level default.</p>
</div>


<p>For document formats that use it, [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>] includes some data structures that are helpful in assigning language (but not paragraph direction) metadata to collections of strings (including entire resources). Notably, it defines what it calls&nbsp;"string internationalization"&nbsp;in the form of a context-scoped&nbsp;<code class="kw" translate="no">@language</code>&nbsp;value which can be associated with blocks of JSON or within individual objects. There is no definition for base direction, so the&nbsp;<code class="kw" translate="no">@context</code>&nbsp;mechanism does not currently address all concerns raised by this document.</p>


<div class="req" id="bp-use_jsonld_i18n_namespace"><a href="#bp-use_jsonld_i18n_namespace" class="self-link">§</a>
	<p class="advisement">Specifications <em class="rfc2119">SHOULD</em> use the <code class="kw" translate="no">i18n</code> Namespace feature for RDF literals, as defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>] 1.1.</p>
</div>

<div class="req" id="bp_use_jsonld_atsign"><a href="#bp_use_jsonld_atsign" class="self-link">§</a>
<p class="advisement">Where the <code class="kw" translate="no">i18n</code> Namespace is not available or is inappropriate to use, specifications <em class="rfc2119">SHOULD</em> require [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>] plain string literals for natural language values to provide string-specific language information.</p>
</div>

<p>Some datatypes, such as [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-plain-literal" title="rdf:PlainLiteral: A Datatype for RDF Plain Literals (Second Edition)">RDF-PLAIN-LITERAL</a></cite>], already exist that allow for <em>language</em> metadata to be serialized as part of a string value.</p>
<aside class="example" id="example-examples-of-rdf-plain-literals-with-language-tags"><div class="marker">
    <a class="self-link" href="#example-examples-of-rdf-plain-literals-with-language-tags">Example<bdi> 8</bdi></a><span class="example-title">: Examples of RDF plain literals with language tags</span>
  </div>
<pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"title"</span>: <span class="hljs-string">"تصميم و إنشاء مواقع الويب@ar"</span>,
<span class="hljs-string">"tags"</span>: [ <span class="hljs-string">"HTML@en"</span>, <span class="hljs-string">"CSS@en"</span>, <span class="hljs-string">"تصميم المواقع@ar"</span> ]
<span class="hljs-string">"id"</span>: <span class="hljs-string">"978-111887164-5@und"</span></code></pre>
</aside>

</section>

<section id="protocol-strings"><div class="header-wrapper"><h3 id="x2-7-strings-that-are-part-of-a-legacy-protocol-or-format"><bdi class="secno">2.7 </bdi>Strings that are part of a legacy protocol or format</h3><a class="self-link" href="#protocol-strings" aria-label="Permalink for Section 2.7"></a></div>


<div class="req" id="bp_legacy_fmt_dir"><a href="#bp_legacy_fmt_dir" class="self-link">§</a>
   <p class="advisement">For strings that cannot specify direction due to legacy format reasons, specifications <em class="rfc2119">SHOULD</em> specify that the <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-41">string direction</a> of each string depends on first-strong heuristics.</p>
</div>

<div class="req" id="bp_legacy_fmt_nonlang"><a href="#bp_legacy_fmt_nonlang" class="self-link">§</a>
   <p class="advisement">For string values and string fields that are <em>not</em> <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a>, specifications <em class="rfc2119">SHOULD</em> specify that the field is non-linguistic in nature and recommend the language tag <code class="kw" translate="no">zxx</code> ("No linguistic content") be associated with each string value.</p>
</div>

<div class="req" id="bp_legacy_fmt_lang_unknown"><a href="#bp_legacy_fmt_lang_unknown" class="self-link">§</a>
	<p class="advisement">For string values and string fields that are known to contain <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a> but for which there is no possibility of language metadata from the underlying format, specifications <em class="rfc2119">SHOULD</em> specify that the language of the content is unknown and recommend the language tag <code class="kw" translate="no">und</code> ("Undetermined") be associated with each string. Specifications <em class="rfc2119">MAY</em> allow the use of heuristics or the inference of the language from other field values where appropriate and as a last resort.</p>
</div>

<div class="note" role="note" id="language-like-tokens"><div role="heading" class="note-title marker" id="h-note-6" aria-level="4"><span>Note</span></div><div class="">
	<p>Many protocols or formats make use of values that are meant to be human-decipherable tokens, while not being intended as natural language text. This allows people to make use of the value, such as using it for debugging. These can include common protocol elements where which humans expect to view and interact with the values.</p>
	
	<p>Common examples of these include domain names and email addresses. With greater availability of Unicode in these sorts of value spaces, display of these values might vary between systems and environments. For example, font selection, which can vary depending on language, might be different on systems with different default locales.</p>
</div></div>

<p>Some specifications interact with string values defined by existing protocols or formats. Often these strings are not associated with or do not provide language or direction metadata. For example, many HTTP headers define their contents as if their contents were not <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a>, even when those contents are expected to be natural language text. Specifications that act as <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumers</a> or <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producers</a> of these string values have no way to discover what the language or direction metadata is, nor will they have a mechanism to attach such metadata.</p>

<aside class="example" id="example-a-legacy-field-that-cannot-encode-language-or-direction"><div class="marker">
    <a class="self-link" href="#example-a-legacy-field-that-cannot-encode-language-or-direction">Example<bdi> 9</bdi></a><span class="example-title">: A legacy field that cannot encode language or direction</span>
  </div>
<p>The following <code>dictionary</code> defined in the [<cite><a class="bibref" data-link-type="biblio" href="#bib-webtransport" title="WebTransport">Webtransport</a></cite>] specification depends on a data structure defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc9000" title="QUIC: A UDP-Based Multiplexed and Secure Transport">RFC9000</a></cite>].</p>
	
<pre aria-busy="false"><code class="hljs abnf">dictionary WebTransportCloseInfo {
    unsigned long closeCode = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    DOMString reason = <span class="hljs-string">""</span><span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span></code></pre>

<p>Although the field <samp translate="no">reason</samp> is expected to contain a descriptive string, it is defined as an array of bytes (with an expected encoding of UTF-8). Since the underlying protocol does not provide fields for language or direction metadata, it is not possible to accurately derive the values when reading data from the wire and any values generated by producers implementing WebTransport would be dropped when the structure is eventually serialized to the wire format. As a result, consumers cannot know the direction of the string. Using the first-strong heuristic (such as assigning the value <code class="kw" translate="no">auto</code> to an HTML <code class="kw" translate="no">dir</code> attribute when adding the reason message to a text element) is preferred to assigning an arbitrarily computed value. In addition, while the actual language of the field <samp translate="no">reason</samp> cannot be known from the data structure, <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumers</a> should assign a value of <code class="kw" translate="no">und</code> (or the empty value) as the language of the field for display and processing purposes.</p>
</aside>

</section>

<section id="additional-best-practices"><div class="header-wrapper"><h3 id="other_approaches"><bdi class="secno">2.8 </bdi>Additional Best Practices</h3><a class="self-link" href="#other_approaches" aria-label="Permalink for Section 2.8"></a></div>


<div class="req" id="bp_unicode_tag_chars_nonuse"><a href="#bp_unicode_tag_chars_nonuse" class="self-link">§</a>
<p class="advisement">Specifications <em class="rfc2119">SHOULD NOT</em> use the Unicode "language tag" characters (code points <code>U+E0000</code> to <code>U+E007F</code>) for language identification.</p>
</div>

<p>[<cite><a class="bibref" data-link-type="biblio" href="#bib-unicode" title="The Unicode Standard">Unicode</a></cite>] says that the <q>... use of tag characters to convey language tags is strongly discouraged</q> and that the use of the character <span class="uname">U+E0001 LANGUAGE TAG</span> is <em>strongly discouraged</em>.</p>


<div class="req" id="bp_no_paired_bidi"><a href="#bp_no_paired_bidi" class="self-link">§</a>
<p class="advisement">Specifications <em class="rfc2119">MUST NOT</em> require the production or use of <a href="#paired">paired bidi controls</a>.</p>
</div>

<p>Another way to say this is: <strong><em>do not require implementations to modify data passing through them</em></strong>. Unicode bidi control characters might be found in a particular piece of string content, where the producer or data source has used them to make the text display properly. That is, they might already be part of the data. Implementations should not disturb any controls that they find—but they shouldn't be required to produce additional controls on their own.</p>


<div class="req" id="bp_language_indexing"><a href="#bp_language_indexing" class="self-link">§</a>
<p class="advisement">Specifications <em class="rfc2119">SHOULD</em> recommend the use of <a href="#dfn-language-indexing" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-language-indexing-1">language indexing</a> when <a href="#Localizable" class="internalDFN" data-link-type="idl" id="ref-for-Localizable-2"><code>Localizable</code></a> strings can be supplied in multiple languages for the same value.</p>
</div>

<p><a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">Producers</a> sometimes need to supply multiple language values (see <a href="#localization-considerations">Localization Considerations</a>) for the same content item or data record. One use for this <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-language-negotiation">language negotiation</a> by the <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumer</a>.</p>

<div class="note" role="note" id="issue-container-generatedID-6"><div role="heading" class="note-title marker" id="h-note-7" aria-level="4"><span>Note</span></div><aside class="">
	<p>[<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>] <a href="#dfn-language-indexing" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-language-indexing-2">language indexing</a> does not support the use of  <a href="#Localizable" class="internalDFN" data-link-type="idl" id="ref-for-Localizable-3"><code>Localizable</code></a> values or identification of language metadata, such as using <code class="kw" translate="no">i18n</code> namespace additions to values.</p>
</aside></div>


<aside class="example" id="example-10"><div class="marker">
    <a class="self-link" href="#example-10">Example<bdi> 10</bdi></a>
  </div>
<p>Here is the record used in the <a href="#base_example">original example</a> with a record-level default language and default <a data-link-type="dfn|abstract-op" href="#dfn-block-direction" class="internalDFN" id="ref-for-dfn-block-direction-15">block direction</a> added. It also shows the use of a Localizable string to override the document-level defaults for the <code class="kw">author</code> field. Note that this "worked example" is not valid.</p>
<pre aria-busy="false"><code class="hljs javascript">{
    <span class="hljs-string">"@context"</span>: { 
        <span class="hljs-string">"@language"</span>: <span class="hljs-string">"ar"</span>,
        <span class="hljs-string">"@direction"</span>: <span class="hljs-string">"rtl"</span>
    },
    <span class="hljs-string">"id"</span>: {<span class="hljs-string">"978-111887164-5"</span>},
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"HTML و CSS: تصميم و إنشاء مواقع الويب"</span>,
    <span class="hljs-string">"authors"</span>: [ {<span class="hljs-string">"value"</span>: <span class="hljs-string">"Jon Duckett"</span>, <span class="hljs-string">"lang"</span>: <span class="hljs-string">"en"</span>, <span class="hljs-string">"dir"</span>: <span class="hljs-string">"ltr"</span>} ],
    <span class="hljs-string">"pubDate"</span>: <span class="hljs-string">"2008-01-01"</span>,
    <span class="hljs-string">"publisher"</span>: <span class="hljs-string">"مكتبة"</span>,
    <span class="hljs-string">"language"</span>: <span class="hljs-string">"ar"</span>,  <span class="hljs-comment">// recall that this is data about the language of the book's content!</span>
    <span class="hljs-string">"coverImage"</span>: <span class="hljs-string">"https://example.com/images/html_and_css_cover.jpg"</span>,
    <span class="hljs-comment">// etc.</span>
},</code></pre>

<p>Here's a different rendition using [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>]'s <code class="kw" translate="no">i18n</code> Namespace:</p>
<pre aria-busy="false"><code class="hljs javascript">{
    <span class="hljs-string">"@context"</span>: { 
        <span class="hljs-string">"@language"</span>: <span class="hljs-string">"ar"</span>,
        <span class="hljs-string">"@direction"</span>: <span class="hljs-string">"rtl"</span>
    },
    <span class="hljs-string">"id"</span>: {<span class="hljs-string">"978-111887164-5"</span>},
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"HTML و CSS: تصميم و إنشاء مواقع الويب"</span>^^i18n:ar_rtl,
    <span class="hljs-string">"authors"</span>: [ <span class="hljs-string">"Jon Duckett"</span>^^i18n:en-US_ltr ],
    <span class="hljs-string">"pubDate"</span>: <span class="hljs-string">"2008-01-01"</span>,
    <span class="hljs-string">"publisher"</span>: <span class="hljs-string">"مكتبة"</span>^^i18n:ar-eg_rtl,
    <span class="hljs-string">"language"</span>: <span class="hljs-string">"ar"</span>,  <span class="hljs-comment">// recall that this is data about the book content's language!</span>
    <span class="hljs-string">"coverImage"</span>: <span class="hljs-string">"https://example.com/images/html_and_css_cover.jpg"</span>,
    <span class="hljs-comment">// etc.</span>
},</code></pre>
</aside>
</section>

</section> 

<section id="requirements-and-use-cases"><div class="header-wrapper"><h2 id="use_cases"><bdi class="secno">3. </bdi>Requirements and Use Cases</h2><a class="self-link" href="#use_cases" aria-label="Permalink for Section 3."></a></div>

	
	<div class="note" role="note" id="issue-container-generatedID-7"><div role="heading" class="note-title marker" id="h-note-8" aria-level="3"><span>Note</span><span class="issue-label">: Start Here</span></div><div class="">
	<p>Please read the article <a href="https://www.w3.org/International/articles/lang-bidi-use-cases/"><strong>Use cases for bidi and language metadata on the Web</strong></a> for detailed use cases, including a clear illustration of issues such as <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-spillover-effects">spillover</a> or locale-based rendering. This section summarises some key points in that document and related to the need for language and direction metadata.</p>
	</div></div>
	


<section id="why-is-this-important"><div class="header-wrapper"><h3 id="problem_statement"><bdi class="secno">3.1 </bdi>Why is this important?</h3><a class="self-link" href="#problem_statement" aria-label="Permalink for Section 3.1"></a></div>


<p>Information about the language of content is important when processing and presenting <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a> for a variety of reasons. When language information is not present, the resulting degradation in appearance or functionality can frustrate users, render the content unintelligible, or disable important features. Some of the affected processes include:</p> 

<ul>
	<li>Selection of fonts and configuration of rendering options to enable the proper display of different languages. This includes 
	prevention of problems such as: <ul>
		<li>"ransom noting" (showing text using multiple different fonts)</li>
		<li>language specific glyph selection, especially the selection of the correct Chinese/Japanese/Korean font due to important presentational variations for the same characters in these languages
		</li><li>displaying blanks, spaces, question marks, or other disappearance of characters due to the lack of glyphs in the selected font</li> 
	</ul></li>
	<li>Spell checking and other content processing (such as abuse detection, hyphenation, line-breaking, case conversion, etc.) </li> 
	<li>Indexing, search, and other natural language text operations </li> 
	<li>Filtering according to intended audience and language negotiation </li>
	<li>Selection of a text-to-speech voice and processor, such as used for accessibility or in a voice-based interface</li>
</ul>

<p>Similarly, direction metadata is important to the Web. When a string contains text in a script that runs right-to-left (RTL), it must be possible to eventually display that string correctly when it reaches an end user. For that to happen, it is necessary to establish what <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-42">string direction</a> needs to be applied to the string as a whole. The appropriate <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-43">string direction</a> cannot always be deduced by simply looking at the string; even where it is possible, the producer and consumer of the string  need to use the same heuristics to interpret the direction.</p>
  
<p>Static content, such as the body of a Web page or the contents of an 
e-book, often has language or direction information provided by the document format 
or as part of the content metadata. Data formats found on the Web 
generally do not supply this metadata. Base specifications such as 
Microformats, WebIDL, JSON, and more, have tended to store natural 
language text in string objects, without additional metadata.</p>

<p>This places a burden on application authors and data format 
designers to provide the metadata on their own initiative. When 
standardized formats do not address the resulting issues, the result 
can be that, while the data arrives intact, its processing or 
presentation cannot be wholly recovered.</p>

<p>In a distributed Web, any <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumer</a> can also be a <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> for some other process or system. Thus, a given consumer might need to pass language and direction metadata from one document format (and using one <a href="#dfn-agreement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-agreement-3">serialization agreement</a>) to another consumer using a different document format. Lack of consistency in representing language and direction metadata in serialization agreements poses a threat to interoperability and a barrier to consistent implementation.</p>
</section>





<section id="an-example"><div class="header-wrapper"><h3 id="base_example"><bdi class="secno">3.2 </bdi>An example</h3><a class="self-link" href="#base_example" aria-label="Permalink for Section 3.2"></a></div>


<p>Suppose that you are building a Web page to show a 
customer's library of e-books. The e-books exist in a catalog of data 
and consist of the usual data values. A JSON file for a single entry 
might look something like:</p>



<pre id="example1Data" aria-busy="false"><code class="hljs javascript">{
    <span class="hljs-string">"id"</span>: <span class="hljs-string">"978-111887164-5"</span>,
    <span class="hljs-string">"title"</span>: <span class="hljs-string">"HTML و CSS: تصميم و إنشاء مواقع الويب"</span>,
    <span class="hljs-string">"authors"</span>: [ <span class="hljs-string">"Jon Duckett"</span> ],
    <span class="hljs-string">"language"</span>: <span class="hljs-string">"ar"</span>,
    <span class="hljs-string">"pubDate"</span>: <span class="hljs-string">"2008-01-01"</span>,
    <span class="hljs-string">"publisher"</span>: <span class="hljs-string">"مكتبة"</span>,
    <span class="hljs-string">"coverImage"</span>: <span class="hljs-string">"https://example.com/images/html_and_css_cover.jpg"</span>,
    <span class="hljs-comment">// etc.</span>
},</code></pre>

<p>Each of the above is a data field in a database somewhere. There is even information about what language the book is in: (<samp>"language": "ar"</samp>).</p>

<p>A well-internationalized catalog would include additional metadata to what is shown above. That is, for each of the fields containing <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-localizable-text">localizable text</a>, such as the <samp>title</samp> and <samp>authors</samp> fields, there should be language and <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-44">string direction</a> information stored as metadata. (There may be other values as well, such as pronunciation metadata for sorting East Asian language information.) These metadata values are used by consumers of the data to influence the processing and enable the display of the items in a variety of ways. As the JSON data structure 
provides no place to store or exchange these values, it is more difficult to construct internationalized applications.</p>

<p>One work-around might be to encode the values using a mix of HTML and Unicode bidi controls, so that a data value might look like one of the following:</p>

<pre aria-busy="false"><code class="hljs javascript"><span class="hljs-comment">// following examples are NOT recommended</span>
<span class="hljs-comment">// contains HTML markup</span>
<span class="hljs-string">"title"</span>: <span class="hljs-string">"&lt;span lang='ar' dir='rtl'&gt;HTML و CSS: تصميم و إنشاء مواقع الويب&lt;/span&gt;"</span>,
<span class="hljs-comment">// contains LRM as first character</span>
<span class="hljs-string">"authors"</span>: [ <span class="hljs-string">"\u200eJon Duckett"</span> ],</code></pre>

<p>But JSON is a data interchange format: the content might not end up  with the title field being displayed in an HTML context. The JSON above might very well  be used to populate, say, a local data store which uses native controls to show the title and these controls will treat the HTML as string contents. Producers and consumers of the data might not expect to introspect the data in order to supply or remove the extra data or to expose it as metadata. Most JSON libraries don't know anything about the structure of the content that they are serializing. Producers want to generate the JSON file directly from a local data store, such as a database. Consumers want to store or retrieve the value for use without additional consideration of the content of each string. In addition, either producers or consumers can have other considerations, such as field length restrictions, that are affected by the insertion of additional controls or markup. Each of these considerations places special burden on implementers to create arbitrary means of serializing, deserializing, managing, and exchanging the necessary metadata, with interoperability as a casualty along the way.</p> 

<p>(As an aside, note that the markup shown in the above example is actually needed to make the title as well as the inserted markup display correctly in the browser.)</p>
</section>





<section id="isn-t-unicode-enough"><div class="header-wrapper"><h3 id="unicode_enough"><bdi class="secno">3.3 </bdi>Isn't Unicode enough?</h3><a class="self-link" href="#unicode_enough" aria-label="Permalink for Section 3.3"></a></div>


<p>[<cite><a class="bibref" data-link-type="biblio" href="#bib-unicode" title="The Unicode Standard">Unicode</a></cite>] and its character encodings (such as UTF-8) are key elements of the Web and its formats. They provide the ability to encode and exchange text in any language consistently throughout the Internet. However, Unicode by itself does not guarantee perfect presentation and processing of <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-natural-language">natural language</a> text, even though it does guarantee perfect interchange.</p>

<p>Several features of Unicode are sometimes suggested as part of the solution to providing language and direction metadata. Specifically, Unicode bidi controls are suggested for handling direction metadata. In addition, there are "tag" characters in the <code class="kw" translate="no">U+E0000</code> block of Unicode originally intended for use as language tags (although this use is now deprecated). </p>

<p>There are a variety of reasons why the addition of characters to 
data in an interchange format is not a good idea. These include:</p>

<ul>
  <li>Most of the data sources used to assemble the documents on the Web will not contain 
  these characters; producers, in the process of assembling or serializing the data, 
  will need to introspect and insert the characters as needed—changing the data from the original source. Consumers must then deserialize and introspect the information using an identical <a href="#dfn-agreement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-agreement-4">serialization agreement</a>. The consumer has no way of knowing if the characters found in the data were inserted by the producer (and should be removed) or if the characters were part of the source data. Overzealous producers might introduce additional and unnecessary characters, for example adding an additional layer of bidi control codes to a string that would not otherwise require it. Equally, an overzealous consumer might remove characters that are needed by or intended for downstream processes.</li>
  <li>Another challenge is that many applications that use these data formats have limitations on 
  content, such as length limits or character set restrictions. Inserting additional characters into 
  the data may violate these externally applied requirements, and interfere 
  with processing. In the worst case, portions (or all of) the data value itself might be rejected, corrupted, 
  or lost as a result.</li>
  <li>Inserting additional characters changes the identity of the string. This may have important consequences in certain contexts.</li>
  <li>Inserting and removing characters from the string is not a common operation for most data serialization libraries. Any processing that adds language or direction controls would need to introspect the string to see if these are already present or might need to do other processing to insert or modify the contents of the string as part of serializing the data.</li>
</ul>

<div class="note" role="note" id="issue-container-generatedID-8"><div role="heading" class="note-title marker" id="h-note-9" aria-level="4"><span>Note</span></div><p class="">This last consideration is important to call out: document formats are often built and serialized using several layers of code. Libraries, such as general purpose JSON libraries, are expected to store and retrieve faithfully the data that they are passed. Higher-level implementations also generally concern themselves with faithful serialization and de-serialization of the values that they are passed. Any process that alters the data itself introduces variability that is undesirable. For example, consider an application's unit test that checks if the string returned from the document is identical to the one in the data catalog used to generate the document. If bidi controls, HTML markup, or Unicode language tags have been inserted, removed, or changed, the strings might not compare as equal, even though they would be expected to be the same.</p></div>
</section>


<section id="what-consumers-need-to-do-to-support-direction"><div class="header-wrapper"><h3 id="what_consumers_do"><bdi class="secno">3.4 </bdi>What consumers need to do to support direction</h3><a class="self-link" href="#what_consumers_do" aria-label="Permalink for Section 3.4"></a></div>

<p>Given the <a href="">use cases</a> for bidirectional text, it will be clear that a consumer cannot simply insert a string into a target location without some additional work or preparation taking place, first to establish the appropriate <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-45">string direction</a> for the string being inserted, and secondly to apply bidi isolation around the string.</p>
<p>This requires the presence of markup or Unicode formatting controls around the string. If the string's actual direction is opposite that of the content into which it is being inserted, the markup or control codes need to tightly wrap the string. Strings that are inserted adjacent to each other all need to be individually wrapped in order to avoid the spillover issues we saw in the previous section.</p>
<p>[<cite><a class="bibref" data-link-type="biblio" href="#bib-html" title="HTML Standard">HTML</a></cite>] provides base direction controls and isolation for any inline element when the <code class="kw" translate="no">dir</code> attribute is used, or when the <code class="kw" translate="no">bdi</code> element is used. When inserting strings into plain text environments, isolating Unicode formatting characters need to be used. (Unfortunately, support for the isolating characters, which the Unicode Standard recommends as the default for plain text/non-markup applications, is still not universal.)</p>
<p>The trick is to ensure that the direction information provided by the markup or control characters reflects the <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-46">string direction</a> of the string.</p>
</section>
</section>

<section id="approaches-considered-for-identifying-the-string-direction"><div class="header-wrapper"><h2 id="bidi-approaches"><bdi class="secno">4. </bdi>Approaches Considered for Identifying the <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-47">String Direction</a></h2><a class="self-link" href="#bidi-approaches" aria-label="Permalink for Section 4."></a></div>

<p>The fundamental problem for bidirectional text values is how a <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumer</a> of a string will know what <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-48">string direction</a> to use for that string when it is eventually displayed to a user. Note that some of these approaches for identifying or estimating the direction have utility in specific applications and are in use in different specifications such as [<cite><a class="bibref" data-link-type="biblio" href="#bib-html" title="HTML Standard">HTML</a></cite>]. The issue here is which are appropriate to adopt generally and specify for use as a best practice in document formats.</p>

<section id="firststrong"><div class="header-wrapper"><h3 id="x4-1-first-strong-property-detection"><bdi class="secno">4.1 </bdi>First-strong property detection</h3><a class="self-link" href="#firststrong" aria-label="Permalink for Section 4.1"></a></div>
  
<p><strong>This approach is NOT recommended  when used alone, but IS recommended  as a fallback in combination with other approaches.</strong></p>
<section id="how-it-works"><div class="header-wrapper"><h4 id="x4-1-1-how-it-works"><bdi class="secno">4.1.1 </bdi>How it works</h4><a class="self-link" href="#how-it-works" aria-label="Permalink for Section 4.1.1"></a></div>

<p>A producer doesn't need to do anything.</p>
<p>The string is stored as it is.</p>
<p>Consumers must look for the first character in the string with a strong Unicode directional property, and set the <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-49">string direction</a> to match it. They then take appropriate action  to ensure that the string will be displayed as needed. This is not quite so simple as it may appear, for the following reasons:</p>
<ol>
<li>Characters at the start of a string without a strong direction (eg. punctuation, numbers, etc) and isolated sequences (ie. sequences of characters surrounded by RLI/LRI/FSI...PDI formatting characters) within a string must be skipped in order to find the first strong character.</li>
<li>The detection algorithm needs to be able to handle markup at the start of the string. It needs to be able to tell whether the markup is just string text, or whether the markup needs to be parsed in the target location – in which case it must understand the markup, and understand any direction-related information that is carried in the markup.</li>
</ol>
<p>First-strong detection is only needed where the required <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-50">string direction</a> is not already known. If direction is indicated for a string by metadata, either string-specific or via a resource-wide declaration, then first-strong heuristics should not be invoked. For example, first-strong heuristics would produce the wrong result for a string such as "<span lang="ar" dir="rtl">HTML و CSS: تصميم و إنشاء مواقع الويب</span>". This can be corrected using metadata, the use of which signifies informed intention, and you would not need or want to apply heuristics that would then make the result incorrect.</p>
<p>However, if there is no mechanism for the application of metadata, or if there is such a mechanism but the content developer omitted to use it, then first-strong heuristics can be helpful to establish <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-base-direction">base direction</a> in many, though not all, cases. The application of strongly-directional formatting characters can help produce correct results for plain text strings such as the example just quoted, but it is not always possible to apply those (see <a href="#rlm" data-matched-text="[[[#rlm]]]" class="sec-ref"><bdi class="secno">4.3 </bdi>Augmenting <q>first-strong</q> by inserting RLM/LRM markers</a>).</p>
</section>

<section id="advantages"><div class="header-wrapper"><h4 id="x4-1-2-advantages"><bdi class="secno">4.1.2 </bdi>Advantages</h4><a class="self-link" href="#advantages" aria-label="Permalink for Section 4.1.2"></a></div>


<p>Where it is reliable, information about direction can be obtained without any changes to the string, and without the agreements and structures that would be needed to support out-of-band metadata.</p>
</section>

<section id="issues"><div class="header-wrapper"><h4 id="x4-1-3-issues"><bdi class="secno">4.1.3 </bdi>Issues</h4><a class="self-link" href="#issues" aria-label="Permalink for Section 4.1.3"></a></div>


<p>The main problem with this approach is that it produces the wrong result for </p>
<ol>
<li>strings that begin with a strong character with a different directionality than that needed for the string overall (eg. an Arabic tweet that starts with a hashtag)</li>
<li>strings that don't have a strong directional character (such as a telephone number), which are likely to be displayed incorrectly in a RTL context.</li>
<li>strings that begin with markup, such as <code class="kw" translate="no">span</code>, since the first strong character is always going to be LTR.</li>
</ol>
<p>In cases where the entire string starts and ends with RLI/LRI/FSI...PDI formatting characters, it is not possible to detect the first strong character by following the Unicode Bidirectional Algorithm. This is because the algorithm requires that bidi-isolated text be excluded from the detection.</p>
<p>If no strong directional character is found in the string, the direction should probably be assumed to be LTR, and the consumer should act on that basis. This has not been tested fully, however.</p>
<p>If a string contains markup that will be parsed by the consumer as markup, there are additional problems. Any such markup at the start of the string must also be skipped when searching for the first strong directional character. </p>

<p>If <em>parseable</em> markup in the string contains information about the intended direction of the string (for example, a <span class="kw" translate="no"><code class="kw" translate="no">dir</code></span> attribute with the value <span class="kw" translate="no"><code class="kw" translate="no">rtl</code></span> in HTML), that information should be used rather than relying on first-strong heuristics. This is problematic in a couple of ways: (a) it assumes that the consumer of the string understands the semantics of the markup, which may be ok if there is an agreement between all parties to use, say, HTML markup only, but would be problematic, for example, when dealing with random XML vocabularies, and (b) the consumer must be able to  recognise and handle a situation where only the initial part of the string has markup, ie. the markup applies to an inline span of text rather than the string as a whole.</p>

<div class="issue" id="issue-container-number-1"><div role="heading" class="issue-title marker" id="h-issue" aria-level="5"><span>Issue 1</span></div><p class="">It's not clear where the example with the broken link in the following paragraph is or used to be.</p></div>

<p>If, however, there is angle bracket content that is intended to be an <em>example</em> of markup, rather than actual markup, the markup must not be skipped – trying to display markup source code in a RTL context yields very confusing results! It isn't clear, however, how a consumer of the string would always know the difference between examples and parseable strings.</p>
</section>



<section id="additional-notes"><div class="header-wrapper"><h4 id="x4-1-4-additional-notes"><bdi class="secno">4.1.4 </bdi>Additional notes</h4><a class="self-link" href="#additional-notes" aria-label="Permalink for Section 4.1.4"></a></div>


<p>Although first-strong detection is outlined in the Unicode Bidirectional Algorithm (UBA) [<cite><a class="bibref" data-link-type="biblio" href="#bib-uax9" title="Unicode Bidirectional Algorithm">UAX9</a></cite>], it is not the only possible higher-level protocol mentioned for estimating string direction. For example, X (formerly known as Twitter) and Facebook currently use different default heuristics for guessing the base direction of text — neither use just simple first-strong detection, and one uses a completely different method.</p>
</section>
</section>






<section id="metadata"><div class="header-wrapper"><h3 id="x4-2-metadata"><bdi class="secno">4.2 </bdi> Metadata</h3><a class="self-link" href="#metadata" aria-label="Permalink for Section 4.2"></a></div>
  
<p><strong>This approach is recommended.</strong></p>
<p>By 'metadata' we mean field-based information associated with a specific string or a set of strings in a data format, or information built into a string datatype (see also <a href="#dir-approach-new-datatype" data-matched-text="[[[#dir-approach-new-datatype]]]" class="sec-ref"><bdi class="secno">4.7 </bdi>Create a new bidi datatype</a>).</p>
<p>An example would be:</p>
<pre id="example1Data2" aria-busy="false"><code class="hljs css">{
    "title": <span class="hljs-string">"HTML و CSS: تصميم و إنشاء مواقع الويب"</span>,
    <span class="hljs-string">"direction"</span>: <span class="hljs-string">"rtl"</span>,
    <span class="hljs-string">"language"</span>: <span class="hljs-string">"ar"</span>,
},</code></pre>

<p>Metadata indicating the default direction for all the strings in a resource could also be set using an appropriate field.</p>
<section id="how-it-works-0"><div class="header-wrapper"><h4 id="x4-2-1-how-it-works"><bdi class="secno">4.2.1 </bdi>How it works</h4><a class="self-link" href="#how-it-works-0" aria-label="Permalink for Section 4.2.1"></a></div>

<p>A producer ascertains the <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-51">string direction</a> of the string and adds that to a metadata field that accompanies the string when it is stored or transmitted.</p>
<p>There are several approaches to using metadata:</p>
<ol>
<li>Label every string with a <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-52">string direction</a>.</li>
<li>Provide a document-level default for <a href="#dfn-block-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-block-direction-16">block direction</a> and only include metadata for strings whose value is different. The value <code>auto</code> is used when the direction of a string is not known.</li>
<li>Rely on the consumer to do <a href="#firststrong">first-strong detection</a>, and label only those strings which would produce the wrong result (that is, a right-to-left string that starts with left-to-right strong characters).</li>
</ol>
<p>If storing or transmitting a set of strings at a time, it helps to have a field for the resource as a whole that sets a global, default <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-53">string direction</a> which can be inherited by all strings in the resource. Note that in addition to a global field, you still need the possibility of attaching string-specific metadata fields in cases where a string's <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-54">string direction</a> is not the same as the default value. The <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-55">string direction</a> set on an individual string must always override the default.</p>
<p>Consumers would need to understand how to read the metadata sent with a string, and would need to apply first-strong heuristics in the absence of metadata.</p>

<p>The use of the <a href="#use-the-localizable-data-structure">Localizable</a> dictionary structure is <em class="rfc2119">RECOMMENDED</em> for individual values in JSON-based document formats, as it combines both language and direction metadata and, if consistently adopted, makes interchange between different formats easier.</p>
		
<div class="note" role="note" id="issue-container-generatedID-9"><div role="heading" class="note-title marker" id="h-note-10" aria-level="5"><span>Note</span></div><p class="">As noted <a href="#localizable-dictionary">here</a>, [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>] includes some data structures that are helpful in assigning language (but not direction) metadata to collections of strings (including entire resources). These gaps in support for pre-built metadata at the resource or item level are one of the key reasons for this documents development.</p></div>
</section>



<section id="advantages-0"><div class="header-wrapper"><h4 id="x4-2-2-advantages"><bdi class="secno">4.2.2 </bdi>Advantages</h4><a class="self-link" href="#advantages-0" aria-label="Permalink for Section 4.2.2"></a></div>


<p>Passing metadata as separate data value from the string provides a simple, effective and efficient method of communicating the intended <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-56">string direction</a> without affecting the actual content of the string.</p>
<p>If every string is labelled for direction, or the direction for all strings can be ascertained by applying the global setting and any string-specific deviations, it avoids the need to inspect and run heuristics to determine each separate string's <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-57">string direction</a>.</p>
</section>



<section id="issues-0"><div class="header-wrapper"><h4 id="x4-2-3-issues"><bdi class="secno">4.2.3 </bdi>Issues</h4><a class="self-link" href="#issues-0" aria-label="Permalink for Section 4.2.3"></a></div>


<p>Out-of-band information needs to be associated with and kept with strings. This may be problematic for some sets of string data which are not part of a defined framework.</p>
<p>In particular, JSON-LD doesn't allow direction to be associated with individual strings in the same way as it works for language.</p>
</section>
</section>






<section id="rlm"><div class="header-wrapper"><h3 id="x4-3-augmenting-first-strong-by-inserting-rlm-lrm-markers"><bdi class="secno">4.3 </bdi>Augmenting <q>first-strong</q> by inserting RLM/LRM markers</h3><a class="self-link" href="#rlm" aria-label="Permalink for Section 4.3"></a></div>
  
<p><strong>This approach is NOT workable for all situations.</strong></p>


<section id="how-it-works-1"><div class="header-wrapper"><h4 id="x4-3-1-how-it-works"><bdi class="secno">4.3.1 </bdi>How it works</h4><a class="self-link" href="#how-it-works-1" aria-label="Permalink for Section 4.3.1"></a></div>

<p>A producer ascertains the  <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-58">string direction</a> of the string and adds an marker character (either <span class="unicode">U+200F RIGHT-TO-LEFT MARK</span> (RLM) or <span class="unicode">U+200E LEFT-TO-RIGHT MARK</span> (LRM)) to the beginning of the string. The marker is not functional, ie. it will not automatically apply a base direction to the string that can be used by the consumer, it is simply a marker.</p>
<p>There are a number of possible approaches:</p>
<ol>
<li>Add a marker to every string (not recommended).</li>
<li>Rely on the consumer to do <a href="#firststrong">first-strong detection</a>, and add a marker to only those strings which would produce the wrong result (eg. a RTL string that starts with LTR strong characters).</li>
<li>Assume a default of LTR (no marker), and apply only RLM markers.</li>
</ol>
<p>Consumers apply first-strong heuristics to detect the <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-59">string direction</a> for the string. The RLM and LRM characters are strongly typed directionally, and should therefore result in detecting the appropriate base direction.</p>
<p>As described in <a href="#firststrong" data-matched-text="[[[#firststrong]]]" class="sec-ref"><bdi class="secno">4.1 </bdi>First-strong property detection</a>, this approach is not relevant if directional information is provided via metadata.</p>
</section>



<section id="advantages-1"><div class="header-wrapper"><h4 id="x4-3-2-advantages"><bdi class="secno">4.3.2 </bdi>Advantages</h4><a class="self-link" href="#advantages-1" aria-label="Permalink for Section 4.3.2"></a></div>


<p>It provides a reliable way of indicating base direction, as long as the producer can reliably apply markers.</p>
<p>In theory, it should be easier to spot the first-strong character in strings that begin with markup, as long as the correct RLM/LRM is prepended to the string.</p>
</section>



<section id="issues-1"><div class="header-wrapper"><h4 id="x4-3-3-issues"><bdi class="secno">4.3.3 </bdi>Issues</h4><a class="self-link" href="#issues-1" aria-label="Permalink for Section 4.3.3"></a></div>


<p>If the producer is a human, they could theoretically apply one of 
  these characters when creating a string in order to signal the 
  directionality. </p>
<p>A significant  problem with this, especially on mobile devices, is the 
  availability or inconvenience of inputting an RLM/LRM character. The keyboards of mobile devices generally do not provide keys for RLM/LRM characters. Perhaps more important, because the characters are invisible and because Unicode 
  bidi is complicated, it can be difficult for the user to know how to use the character effectively. In fact, a large percentage of users don't actually know what these characters are or what they do.</p>
<p>Furthermore, if a person types information into, say, an HTML form in a RTL page or uses shortcut keys to set the direction for the form field, the strings will look correct without the need to add RLM/LRM. However, used outside of that context, the string would look incorrect unless it is associated with information about the required <a data-link-type="dfn|abstract-op" href="#dfn-block-direction" class="internalDFN" id="ref-for-dfn-block-direction-17">block direction</a>. Similarly, strings scraped from a web page that has <code class="kw" translate="no">dir=rtl</code> set in the <code class="kw" translate="no">html</code> element would not normally have or need an RLM/LRM character at the start of the string in HTML.</p>
<p>It may be possible for the steps used by a producer  to include an examination of the original context of the string for directional information (for example, by testing the computed direction of an HTML form field), followed by automatic insertion of an RLM/LRM mark into the beginning of the string where necessary. An issue with this approach is that it changes the string value and identity. This may also create problems for working with string length 
or pointer positions, especially if some producers add markers and others don't.</p>
<p>If directional information is contained in markup that will be 
  parsed as such by the consumer (for example, <code class="kw" translate="no">dir=rtl</code> in HTML),  the producer  of the string 
  needs to understand that markup in order to set or not set an RLM/LRM 
  character as appropriate. If the producer always adds RLM/LRM to the 
  start of such strings, the consumer is expected to know that. If the 
  producer relies instead on the markup being understood, the consumer 
is expected to understand the markup.</p>
<p>The producer of a string should not automatically apply RLM or LRM 
  to the start of the string, but should test whether it is needed. 
  For example, if there's already an RLM in the text, there is no need to add another. 
  If the context is correctly conveyed by first-strong heuristics, there is no 
  need to add additional characters either. Note, however, that testing 
  whether supplementary directional information of this kind is needed 
  is only possible if the producer has access, and knows that it has 
access, to the original context of the string. Many document formats are generated from data stored away from the original context. For example, the catalog of books in the <a href="#base_example">original example</a> above is disconnected from the user inputing the bidirectional text.</p>
</section>
</section>





<section id="paired"><div class="header-wrapper"><h3 id="x4-4-paired-formatting-characters"><bdi class="secno">4.4 </bdi>Paired formatting characters</h3><a class="self-link" href="#paired" aria-label="Permalink for Section 4.4"></a></div>
  
<p><strong>This approach is NOT recommended.</strong></p>


<section id="how-it-works-2"><div class="header-wrapper"><h4 id="x4-4-1-how-it-works"><bdi class="secno">4.4.1 </bdi>How it works</h4><a class="self-link" href="#how-it-works-2" aria-label="Permalink for Section 4.4.1"></a></div>

<p>A producer ascertains the <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-60">string direction</a> of the string and adds a directional formatting character (one of <span class="unicode">U+2066 LEFT-TO-RIGHT ISOLATE</span> (LRI), <span class="unicode">U+2067 RIGHT-TO-LEFT ISOLATE</span> (RLI),<span class="unicode"> U+2068 FIRST STRONG ISOLATE</span> (FSI),<span class="unicode"> U+202A LEFT-TO-RIGHT EMBEDDING</span> (LRE), or <span class="unicode">U+202B RIGHT-TO-LEFT EMBEDDING</span> (RLE)) to the beginning of the string, and  <span class="unicode">U+2069 POP DIRECTIONAL ISOLATE</span> (PDI) or  <span class="unicode">U+202C POP DIRECTIONAL FORMATTING</span> (PDF) to the end.</p>
<p>There are a number of possible approaches:</p>
<ol>
<li>Add the formatting codes to every string.</li>
<li>Rely on the consumer to do <a href="#firststrong">first-strong detection</a>, and add a marker to only those strings which would produce the wrong result (eg. a RTL string that starts with LTR strong characters).</li>
</ol>
<p>Consumers  would theoretically just insert the string in the place it will be displayed, and rely on the formatting codes to manage directionality. However, things are not quite so simple (see below).</p>
<p>There are two types of paired formatting characters. The original set of controls provide the ability to add an additional level of bidirectional "embedding" to the Unicode bidirectional Algorithm. More recently, Unicode added a complementary set of "isolating" controls. Isolating controls are used to surround a string. The inside of the string is treated as its own bidirectional sequence, and the string is protected against spill-over effects related to any surrounding text. The enclosing string treats the entire surrounded string as a single unit that is ignored for bidi reordering. This issue is described <a href="https://www.w3.org/TR/html-bidi/#bidi-isolation-problem">here</a>.</p>
<table>
<tbody>
<tr>
<td>Code Point</td>
<td>Abbreviation</td>
<td>Description</td>
<td>Code Point</td>
<td>Abbreviation</td>
<td>Description</td>
</tr>
<tr>
<td>U+200A</td>
<td>LRE</td>
<td>Left to Right Embedding</td>
<td>U+2066</td>
<td>LRI</td>
<td>Left to Right Isolate</td>
</tr>
<tr>
<td>U+200B</td>
<td>RLE</td>
<td>Right to Left Embedding</td>
<td>U+2067</td>
<td>RLI</td>
<td>Right to Left Isolate</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>U+2068</td>
<td>FSI</td>
<td>First Strong Isolate</td>
</tr>
<tr>
<td>U+200C</td>
<td>PDF</td>
<td>Pop Directional Formatting (ending an embedding)</td>
<td>U+2069</td>
<td>PDI</td>
<td>Pop Directional Isolate (ending an isolate)</td>
</tr>
</tbody>
</table>
<p>If paired formatting characters are used, they should be isolating, ie. starting with RLI, LRI, FSI, and not with RLE or LRE.</p>
</section>



<section id="advantages-2"><div class="header-wrapper"><h4 id="x4-4-2-advantages"><bdi class="secno">4.4.2 </bdi>Advantages</h4><a class="self-link" href="#advantages-2" aria-label="Permalink for Section 4.4.2"></a></div>


<p>There are no real advantages to using this approach.</p>
</section>



<section id="issues-2"><div class="header-wrapper"><h4 id="x4-4-3-issues"><bdi class="secno">4.4.3 </bdi>Issues</h4><a class="self-link" href="#issues-2" aria-label="Permalink for Section 4.4.3"></a></div>


<p>This approach is  only appropriate if it is acceptable to change the value of the string. In addition to possible issues such as changed string length or pointer positions, this approach runs a real and serious risk of one of the paired characters getting lost, either through handling errors, or through text truncation, etc.</p>
<p>A  producer and a consumer of a string would need to recognise and handle a situation where a string begins with a paired formatting character but doesn't end with it because the formatting characters only describe a part of the string.</p>
<p>Unicode specifies a limit to the number of embeddings that are effective, and embeddings could build up over time to exceed that limit.</p>
<p>Consuming applications would need to recognise and appropriately handle the isolating formatting characters. At the moment such support for RLI/LRI/FSI is far from pervasive.</p>
<p>This approach would disqualify the string from being amenable to UBA first-strong heuristics if used by a non-aware <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumer</a>, because the Unicode bidi algorithm is unable to ascertain the base direction for a string that starts with RLI/LRI/FSI and ends with PDI. This is because the algorithm skips over isolated sequences and treats them as a neutral character. A <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumer</a> of the string would have to take special steps in such a case to locate the first-strong character.</p>

</section>
</section>



<section id="script_subtag"><div class="header-wrapper"><h3 id="x4-5-script-subtags"><bdi class="secno">4.5 </bdi>Script subtags</h3><a class="self-link" href="#script_subtag" aria-label="Permalink for Section 4.5"></a></div>
  
<p><strong>This approach is only recommended as a workaround for situations that prevent the use of metadata.</strong></p>


<section id="how-it-works-3"><div class="header-wrapper"><h4 id="x4-5-1-how-it-works"><bdi class="secno">4.5.1 </bdi>How it works</h4><a class="self-link" href="#how-it-works-3" aria-label="Permalink for Section 4.5.1"></a></div>

<p>A <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> <a href="#localizable-dictionary">supplies language metadata</a> for strings, specifying, where necessary, the script in use.</p>

<p>There are a number of possible approaches:</p>
<ol>
<li>Label every string for language, including a script subtag as needed. <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">Consumers</a> may need to compute the script subtag when the <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> does not provide one.</li>
<li>It might be reasonable to assume a default of LTR for all strings unless marked with a language tag whose script subtag (either present or implied) indicates RTL.</li>
<li>Alternatively, limit the use of script subtag metadata to situations where <a href="#firststrong">first-strong heuristics</a> are expected to fail — provided that such cases can be identified, and appropriate action taken by the producer (not always reliable). <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">Consumers</a> would then need to use first-strong heuristics in the absence of a script subtag in order to identify the appropriate <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-61">string direction</a>. The use of script subtags should not, however, be restricted to strings that need to indicate direction; it is perfectly valid to associate a script subtag with any string.</li>
<li>Set a default language for a set of strings at a higher level, but provide a mechanism to override that default for a given string where needed.</li>
</ol>
<p><a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">Consumers</a> extract the script subtag from the language tag associated with each string, computing the string's <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-62">string direction</a> as necessary. Script subtags associated with RTL scripts are used to assign a direction of RTL to their associated strings.</p>

<p>Language information <em class="rfc2119">MUST</em> use [<cite><a class="bibref" data-link-type="biblio" href="#bib-bcp47" title="Tags for Identifying Languages">BCP47</a></cite>] language tags. The portion of the language tag that carries the information is the script subtag, not the primary language subtag. For example, Azeri may be written LTR (with the Latin or Cyrillic scripts) or RTL (with the Arabic script).  Thus, the subtag <code class="kw" translate="no">az</code> is insufficient to clarify intended <a data-link-type="dfn|abstract-op" href="#dfn-block-direction" class="internalDFN" id="ref-for-dfn-block-direction-18">block direction</a>. A language tag such as <code class="kw" translate="no">az-Arab</code> (Azeri as written in the Arabic script), however, can generally be relied upon to indicate that the <a data-link-type="dfn|abstract-op" href="#dfn-block-direction" class="internalDFN" id="ref-for-dfn-block-direction-19">block direction</a> should be RTL. </p>
 
<div class="note" role="note" id="issue-container-generatedID-10"><div role="heading" class="note-title marker" id="h-note-11" aria-level="5"><span>Note</span></div><aside class="">
	
<p>Script subtags should only be used in language tags when the language's script is not implied by other information in the language tag. Implementations and specifications <em class="rfc2119">SHOULD NOT</em> require the addition or generation of script subtags not already present in a language tag. The IANA Language Subtag Registry, defined by [<cite><a class="bibref" data-link-type="biblio" href="#bib-bcp47" title="Tags for Identifying Languages">BCP47</a></cite>] contains a <code class="kw">Suppress-Script</code> field for a few languages, indicating the script where it is missing. Additionally, the [<cite><a class="bibref" data-link-type="biblio" href="#bib-ldml" title="Unicode Technical Standard #35: Unicode Locale Data Markup Language (LDML)">LDML</a></cite>] specification defines a "likely subtag" mechanism that can often be used to supply a missing script subtag. For example, language tags such as <code class="kw">ar</code> (Arabic) or <code class="kw">ar-EG</code> (Arabic as used in Egypt), imply the <code class="kw">Arab</code> (Arabic) script subtag, since nearly all Arabic is written in this script.</p>

</aside></div> 

</section>



<section id="advantages-3"><div class="header-wrapper"><h4 id="x4-5-2-advantages"><bdi class="secno">4.5.2 </bdi>Advantages</h4><a class="self-link" href="#advantages-3" aria-label="Permalink for Section 4.5.2"></a></div>


<p>There is no need to inspect or change the string itself.</p>
<p>This approach avoids the issues associated with first-strong detection when the first-strong character is not indicative of the necessary <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-63">string direction</a> for the string, and avoids issues relating to the interpretation of markup.</p>
<p>Note that a string that begins with markup that sets a language for the string text content (eg. <code translate="no">&lt;cite lang="zh-Hans"&gt;</code>) is not problematic here, since that language declaration is not expected to play into the setting of the <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-64">string direction</a>.</p>
</section>



<section id="issues-3"><div class="header-wrapper"><h4 id="x4-5-3-issues"><bdi class="secno">4.5.3 </bdi>Issues</h4><a class="self-link" href="#issues-3" aria-label="Permalink for Section 4.5.3"></a></div>

<p>The use of metadata as outlined above is a much better approach, if it is available. This script-related approach is only for use where that approach is unavailable, for legacy reasons.</p>
<p>There are many strings which are not language-specific but which absolutely need to be associated with a particular <a data-link-type="dfn|abstract-op" href="#dfn-block-direction" class="internalDFN" id="ref-for-dfn-block-direction-20">block direction</a> for correct consumption. For example, MAC addresses inserted into a RTL context need to be displayed with a LTR overall base direction and also be isolated from the surrounding text. It's not clear how to distinguish these cases from others (in a way that would be feasible when using direction metadata). Special language tags, such as <code class="kw">zxx</code> (Non-Linguistic), exist for identifying this type of content, but usually data fields of this type omit language information altogether, since it is not applicable.</p>
<p>The list of script subtags may be added to in future. In that case, any subtags that indicate a default RTL direction need to be added to the lists used by the consumers of the strings.</p>
<p>There are some rare situations where the appropriate <a data-link-type="dfn|abstract-op" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-paragraph-direction">paragraph direction</a> cannot be identified from the script subtag, but these are really limited to archaic usage of text.  For example, Japanese and Chinese text prior to World War 2 was often written RTL, rather than LTR. Languages such as those written using Egyptian Hieroglyphs, or the Tifinagh Berber script, could formerly be written either LTR or RTL, however the default for scholastic research tends to LTR.</p>
</section>



<section id="other-comments"><div class="header-wrapper"><h4 id="x4-5-4-other-comments"><bdi class="secno">4.5.4 </bdi>Other comments</h4><a class="self-link" href="#other-comments" aria-label="Permalink for Section 4.5.4"></a></div>

<p>The approach outlined here is only appropriate when declaring information about the <em>overall</em> <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-65">string direction</a> to be associated with a string. We do <em>not</em> recommend  use of language data to indicate text direction within strings, since the usage patterns are not interchangeable.</p>
</section>
</section>





<section id="require-bidi-markup-for-content"><div class="header-wrapper"><h3 id="html-content"><bdi class="secno">4.6 </bdi>Require bidi markup for content</h3><a class="self-link" href="#html-content" aria-label="Permalink for Section 4.6"></a></div>
    
    
    <p><strong>This approach is NOT recommended, except under <a href="#dfn-agreement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-agreement-5">serialization agreements</a> that expect to exclusively interchange HTML or XML markup data.</strong></p>
    
    <section id="how-it-works-4"><div class="header-wrapper"><h4 id="html-content-how"><bdi class="secno">4.6.1 </bdi>How it works</h4><a class="self-link" href="#html-content-how" aria-label="Permalink for Section 4.6.1"></a></div>
    
<p>The producer ensures that all strings begin and end with markup which indicates the appropriate base direction for that string. This requires the producer to examine the string. If the string is not bounded by markup with directional information, the producer must add wrap the string with elements that have the <code class="kw" translate="no">dir</code> or <code class="kw" translate="no">its:direction</code> [<cite><a class="bibref" data-link-type="biblio" href="#bib-its20" title="Internationalization Tag Set (ITS) Version 2.0">ITS20</a></cite>] attributes, or other markup appropriate to a given XML application. If the string <em>is</em> bounded by markup, but it is something such as an HTML <code class="kw" translate="no">h1</code> element, the producer needs to introduce directional information into the existing markup, rather than simply surround the string with a <code class="kw" translate="no">span</code>.</p>
<p>This example uses HTML markup. (Simply to make the example easier to read, it shows the text content of the string as it should be displayed, rather than in the order in which the characters are stored.)</p>
    
<aside class="example" id="example-11"><div class="marker">
    <a class="self-link" href="#example-11">Example<bdi> 11</bdi></a>
  </div>
	<pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"title"</span>: <span class="hljs-string">"&lt;span dir="</span>rtl<span class="hljs-string">" lang="</span>ar<span class="hljs-string">"&gt;HTML و CSS: تصميم و إنشاء مواقع الويب&lt;/span&gt;"</span></code></pre>
</aside>
    <p>The consumer then relies on the markup to set the base direction around the text content of the string when it is displayed. (Note that, unless additional metadata is provided, the consumer cannot remove the markup before integrating the string in the target location, because it cannot tell what markup has been added by the producer and what was already there. In general, however, such added markup is harmless.)</p>
    </section>
    
    <section id="advantages-4"><div class="header-wrapper"><h4 id="html-content-advantages"><bdi class="secno">4.6.2 </bdi>Advantages</h4><a class="self-link" href="#html-content-advantages" aria-label="Permalink for Section 4.6.2"></a></div>
		
<p>The benefit for content that already uses markup is clear. The content will already provide complete markup necessary for the display and processing of the text or it can be extracted from the source page context. HTML and XML processors already know how to deal with this markup and provide ready validation.</p>
<p>For HTML, the <code class="kw" translate="no">dir</code> attribute bidirectionally isolates the content from the surrounding text, which removes spillover conflicts. This reduces the work of the consumer.</p>
		
		<p>Markup can also be used for string-internal directional information, something <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-66">string direction</a> on its own cannot solve.</p>
    </section>
    <section id="issues-4"><div class="header-wrapper"><h4 id="html-content-issues"><bdi class="secno">4.6.3 </bdi>Issues</h4><a class="self-link" href="#html-content-issues" aria-label="Permalink for Section 4.6.3"></a></div>
		
    </section>
    
    <p>Effectively, all levels of the implementation stack have to participate in understanding the markup (or ensure that they do no harm).</p>
<p>If the system uses HTML, end to end, then appropriate markup is available and its semantics are understood (ie. the <code class="kw" translate="no">dir</code> attribute, and the <code class="kw" translate="no">bdi</code> and <code class="kw" translate="no">bdo</code> elements). For XML applications, however, there is no standard markup for bidi support. Such markup would need to first be defined, and then understood by both the producer and consumer.</p>
<p>A key  downside of this approach is that many data values are just strings. As with adding Unicode tags or Unicode bidi controls, the addition of markup to strings alters the original string content. Altering the length of the content can cause problems with processes that enforce arbitrary limits or with processes that "sanitize" content by escaping HTML/XML unsafe characters such as angle brackets.</p>
<p>Another issue is the work and sophistication required for producers to examine strings and add markup as needed.</p>
<p>There are limits to the number of embeddings allowed by the Unicode bidirectional algorithm. Consumers would need to ensure that this limit is not passed when embedding strings into a wider context.</p>
<p>The addition of markup also requires consumers to guard against the usual problems with markup insertion, such as XSS attacks.</p>
   
</section>


  <section id="dir-approach-new-datatype"><div class="header-wrapper"><h3 id="x4-7-create-a-new-bidi-datatype"><bdi class="secno">4.7 </bdi>Create a new bidi datatype</h3><a class="self-link" href="#dir-approach-new-datatype" aria-label="Permalink for Section 4.7"></a></div>
    
    
    <p><strong>This approach was added to [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>] 1.1.</strong></p>
    
    <section id="how-it-works-5"><div class="header-wrapper"><h4 id="dir-approach-new-datatype-how"><bdi class="secno">4.7.1 </bdi>How it works</h4><a class="self-link" href="#dir-approach-new-datatype-how" aria-label="Permalink for Section 4.7.1"></a></div>
	
	
    <p>This is similar to the idea of sending metadata with a string as discussed previously, however the metadata is not stored in a completely separate field (as in  <a href="#metadata" class="sec-ref"><bdi class="secno">4.2 </bdi> Metadata</a>), or inserted into the string itself (as in <a href="#rlm" class="sec-ref"><bdi class="secno">4.3 </bdi>Augmenting <q>first-strong</q> by inserting RLM/LRM markers</a>), but is associated with the string as part of the string's serialization format.</p>
    <p>Some datatypes, such as [<cite><a class="bibref" data-link-type="biblio" href="#bib-rdf-plain-literal" title="rdf:PlainLiteral: A Datatype for RDF Plain Literals (Second Edition)">RDF-PLAIN-LITERAL</a></cite>], already exist that allow for <em>language</em> metadata to be serialized as part of a string value. However, these do not include a consideration for direction. This might be addressed by defining a new datatype (or extending an existing one) that document formats could then use to serialize natural language strings that includes both language and direction metadata.</p>
    <p>[<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>] 1.1. added the <code class="kw" translate="no">i18n</code> Namespace to permit JSON documents to serialize language and direction metadata directly with a string value. It provides a deserialization to RDF for specifications that need it.</p>
  
<aside class="example" id="example-12"><div class="marker">
    <a class="self-link" href="#example-12">Example<bdi> 12</bdi></a>
  </div>  
	<p>Using RDF plain string literals as a model, here is what a serialization <em>might</em> look like. (The RTL text is shown in the order in which characters are stored in memory, rather than the display order.)</p>
<pre aria-busy="false"><code class="hljs javascript">myLocalizedString:     <span class="hljs-string">"Hello World!"</span>^^i18n:en_ltr            <span class="hljs-comment">// language and direction</span>
<span class="hljs-attr">myLocalizedString_ar</span>:  <span class="hljs-string">"مرحبا بالعالم!"</span>^^i18n:ar_rtl          <span class="hljs-comment">// right-to-left example</span>
<span class="hljs-attr">myLocalizedString_fr</span>:  <span class="hljs-string">"Bonjour monde !"</span>^^i18n:fr             <span class="hljs-comment">// language only</span>
<span class="hljs-attr">myLocalizedString_und</span>: <span class="hljs-string">"שלום עולם!"</span>^^i18n:_rtl                <span class="hljs-comment">// direction information only</span>
<span class="hljs-attr">myDataString</span>:          <span class="hljs-string">"978-0-123-4567-X"</span>^^i18n:_ltr          <span class="hljs-comment">// language-neutral string</span></code></pre>
</aside>

<p>Note that the last string does not include language information  because it is an internal data value, but <em>does</em> include direction information because strings of this kind <em>must</em> be presented in the LTR order.</p>
<p>A <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> would need to attach the <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-67">string direction</a> to each string as needed.</p>
<p>Each <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumer</a> should use <a href="#firststrong">first-strong heuristics</a> for those strings that don't use this approach or do not contain <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-68">string direction</a>. The <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> would then only add <a href="#dfn-string-direction" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-string-direction-69">string direction</a> information if the first-strong approach would otherwise produce the wrong result. This might simplify the management of strings and the amount of data to be transmittted, because the number of strings requiring metadata is relatively small.</p>
<p>The <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumer</a> would look to see whether the string has metadata associated with it, in which case it would set the indicated <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-70">string direction</a>. Otherwise, it would use first-strong heuristics to determine the string direction of the string.</p>

  </section>
<section id="advantages-5"><div class="header-wrapper"><h4 id="x4-7-2-advantages"><bdi class="secno">4.7.2 </bdi>Advantages</h4><a class="self-link" href="#advantages-5" aria-label="Permalink for Section 4.7.2"></a></div>
    
	  <p>If a new datatype were added to JSON to support natural language strings, then specifications could easily specify that type for use in document formats. Since the format is standardized, <a data-lt="producer" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producers</a> and <a data-lt="consumer" data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumers</a> would not need to guess about direction or language information when it is encoded.</p>
  </section>
  <section id="issues-5"><div class="header-wrapper"><h4 id="x4-7-3-issues"><bdi class="secno">4.7.3 </bdi>Issues</h4><a class="self-link" href="#issues-5" aria-label="Permalink for Section 4.7.3"></a></div>
      
  <p>Apart from the fact that this currently doesn't work, the downside of adding a datatype is that JSON is a widely implemented format, including many ad-hoc implementations. Any new serialization form would likely break or cause interoperability problems with these existing implementations. JSON is not designed to be a "versioned" format. Any serialization form used would need to be transparent to existing JSON processors and thus could introduce unwanted data or data corruption to existing strings and formats.</p>
  </section>
  </section>


</section>

<section id="approaches-considered-for-identifying-the-language-of-content"><div class="header-wrapper"><h2 id="language-approaches"><bdi class="secno">5. </bdi>Approaches Considered for Identifying the Language of Content</h2><a class="self-link" href="#language-approaches" aria-label="Permalink for Section 5."></a></div>


<p>This section deals with different means of determining or conveying the language of string values.</p>

<section id="localizable-dictionary"><div class="header-wrapper"><h3 id="language-metadata"><bdi class="secno">5.1 </bdi>Metadata</h3><a class="self-link" href="#language-metadata" aria-label="Permalink for Section 5.1"></a></div>
	

<p><strong>This approach is recommended.</strong></p>

<section id="how-it-works-6"><div class="header-wrapper"><h4 id="localizable-dictionary-how"><bdi class="secno">5.1.1 </bdi>How it works</h4><a class="self-link" href="#localizable-dictionary-how" aria-label="Permalink for Section 5.1.1"></a></div>


<p>A <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> ascertains the language of the string (generally from metadata supplied upstream) and includes this information a metadata field that accompanies the string when it is stored or transmitted.</p>

<p>When storing or transmitting a set of strings at a time, it helps to have a field for the resource as a whole that sets a language which can be inherited by all strings in the resource. Note that in addition to a global field, you still need the possibility of attaching string-specific metadata fields in cases where a string's language is not that of the default. The language set on an individual string must override any resource-level value.</p>

<p>A <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumer</a> needs to understand how to read the metadata associated with a string and apply it to the display, processing, or data structures that it generates. Note that this might include the need to apply a resource-level default language when serializing or exchanging an individual value.</p>

</section>

<section id="advantages-6"><div class="header-wrapper"><h4 id="localizable-dictionary-advantages"><bdi class="secno">5.1.2 </bdi>Advantages</h4><a class="self-link" href="#localizable-dictionary-advantages" aria-label="Permalink for Section 5.1.2"></a></div>
	
	
	<p>Using a consistent and well-defined data structure makes it more likely that different standards are composable and will work together seamlessly.</p>
	
	<p>Metadata can be supplied without affecting the content itself.</p>
	<p>Where metadata is unavailable, it can be omitted.</p>
	<p>Consumers and producers do not have to instrospect the data outside of their normal processing.</p>
</section>
<section id="issues-6"><div class="header-wrapper"><h4 id="localizable-dictionary-issues"><bdi class="secno">5.1.3 </bdi>Issues</h4><a class="self-link" href="#localizable-dictionary-issues" aria-label="Permalink for Section 5.1.3"></a></div>
	
	
<p>Serialized files utilizing the dictionary and its data values will contain additional fields and can be more difficult to read as a result.</p>

<p>For existing document formats, it represents a change to the values being exchanged.</p>

</section>
</section>

<section id="require-markup-for-content"><div class="header-wrapper"><h3 id="html-content-lang"><bdi class="secno">5.2 </bdi>Require markup for content</h3><a class="self-link" href="#html-content-lang" aria-label="Permalink for Section 5.2"></a></div>
    
    
    <p><strong>This approach is NOT recommended</strong> except in special cases where the content being exchanged is expected to consist of and is restricted to literal values in a given markup language.</p>
    
    <section id="how-it-works-7"><div class="header-wrapper"><h4 id="html-content-lang-how"><bdi class="secno">5.2.1 </bdi>How it works</h4><a class="self-link" href="#html-content-lang-how" aria-label="Permalink for Section 5.2.1"></a></div>
    
    
	<p>When a document is expected to consist of HTML or XML fragments and will be processed and displayed strictly in a markup context, the <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> can use markup to convey the language of the content by wrapping strings with elements that have the <code class="kw" translate="no">lang</code> or <code class="kw" translate="no">xml:lang</code> attributes. </p>
    
  
    </section>
    
    <section id="advantages-7"><div class="header-wrapper"><h4 id="html-content-lang-advantages"><bdi class="secno">5.2.2 </bdi>Advantages</h4><a class="self-link" href="#html-content-lang-advantages" aria-label="Permalink for Section 5.2.2"></a></div>
		
		
		<p>This approach, and thus the advantages, are effectively the same as in <a href="#html-content">this section</a>.</p>
    </section>
    <section id="issues-7"><div class="header-wrapper"><h4 id="html-content-lang-issues"><bdi class="secno">5.2.3 </bdi>Issues</h4><a class="self-link" href="#html-content-lang-issues" aria-label="Permalink for Section 5.2.3"></a></div>
		
    </section>
    
    <p>See <a href="#html-content-issues">above</a>.</p>
   
</section>
  
  


<section id="unicodeTags"><div class="header-wrapper"><h3 id="x5-3-use-unicode-language-tag-characters"><bdi class="secno">5.3 </bdi>Use Unicode language tag characters</h3><a class="self-link" href="#unicodeTags" aria-label="Permalink for Section 5.3"></a></div>
   
  <p><strong>This approach is NOT recommended.</strong></p>
  
  <div class="warning" id="issue-container-generatedID-11"><div role="heading" class="warning-title marker" id="h-warning" aria-level="4"><span>Warning</span></div><aside class="">
	  <p>As noted in <a href="#bp_unicode_tag_chars_nonuse">this best practice</a>, Unicode tag characters in the <code>U+E0000</code> block <em class="rfc2119">SHOULD NOT</em> be used to encode language tags. This section mainly exists to provide guidance to specifications against adopting these as a potential solution.</p>
  </aside></div>
  
  <section id="how-it-works-8"><div class="header-wrapper"><h4 id="unicode-tags-how"><bdi class="secno">5.3.1 </bdi>How it works</h4><a class="self-link" href="#unicode-tags-how" aria-label="Permalink for Section 5.3.1"></a></div>
  

  <p><a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">Producers</a> insert Unicode tag characters into the data to tag strings with a language.</p>
  <p><a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">Consumers</a> process the Unicode tag characters and use them to assign the language.</p>

  <p>Unicode defines special characters that can be used as language tags. These characters are "default ignorable" and should have no visual appearance. Here is how Unicode tags are supposed to work:</p>
  
  <p>Each tag is a character sequence. The sequence begins with a tag identification character. The only one currently defined is <code>U+E0001</code>, which identifies [<cite><a class="bibref" data-link-type="biblio" href="#bib-bcp47" title="Tags for Identifying Languages">BCP47</a></cite>] language tags. Other types of tags are possible, via private agreement. The remainder of the Unicode block for forming tags mirrors the printable ASCII characters. That is, <code>U+E0020</code> is space (mirroring <code>U+0020</code>), <code>U+E0041</code> is capital A (mirroring <code>U+0041</code>), and so forth. Following the tag identification character, producers use each tag character to spell out a [<cite><a class="bibref" data-link-type="biblio" href="#bib-bcp47" title="Tags for Identifying Languages">BCP47</a></cite>] language tag  using the upper/lowercase letters, digits, and the hyphen character. A given source language tag, which is composed from ASCII letters, digits and hyphens, can be transmogrified into tags by adding <code>0xE0000</code> to each character's code point. Additional structure, such as a language priority list (see [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc4647" title="Matching of Language Tags">RFC4647</a></cite>]) might be constructed using other characters such as comma or semi-colon, although Unicode does not define or even necessarily permit this.</p>
  
  <p>The end of a tag's scope is signalled by the end of the string, or can be signalled explicitly using the cancel tag character U+E007F, either alone (to cancel all tags) or preceeded by the language tag identification character <code>U+E0001</code> (i.e. the sequence <code>&lt;U+E0001,U+E007F&gt;</code> to end only language tags).</p>
  
    
  <p>Tags therefore have a minimum of three characters, and can easily be 12 or more. Furthermore, these characters are supplementary characters. That is, they are encoded using 4-bytes per character in UTF-8 and they are encoded as a surrogate pair (two 16-bit code units) in UTF-16. Surrogate pairs are needed to encode these characters in string types for languages such as Java and JavaScript that use UTF-16 internally. The use of surrogates makes the strings somewhat opaque. For example, <code>U+E0020</code> is encoded in UTF-16 as <kbd>0xDB40.DC20</kbd> and in UTF-8 as the byte sequence <kbd>0xF3.A0.80.A0</kbd>.</p>
  

  </section>
  <section id="advantages-8"><div class="header-wrapper"><h4 id="unicode-tag-advantages"><bdi class="secno">5.3.2 </bdi>Advantages</h4><a class="self-link" href="#unicode-tag-advantages" aria-label="Permalink for Section 5.3.2"></a></div>
	  
	  <p>These language tag characters could be used as part of normal Unicode text without modification to the structure of the document format.</p>
  </section>
  <section id="issues-8"><div class="header-wrapper"><h4 id="unicode-tag-issues"><bdi class="secno">5.3.3 </bdi>Issues</h4><a class="self-link" href="#unicode-tag-issues" aria-label="Permalink for Section 5.3.3"></a></div>
	  
	  
<p>Use of Unicode tag characters for language identification are strongly discouraged by the Unicode Consortium (and thus deprecated). These tag characters were intended for use in language tagging within plain text contexts and are often suggested as an alternate means of providing in-band non-markup language tagging. We are unaware of any implementations that use them as language tags.</p>
	  
<p>Applications that treat the characters as unknown Unicode characters will display them as tofu (hollow box replacement characters) and may count them towards length limits, etc. So they are only useful when applications or interchange mechanisms are fully aware of them and can remove them or disregard them appropriately. Although the characters are not supposed to be displayed or have any effect on text processing, in practice they can interfere with normal text processes such as truncation. line wrapping, hyphenation, spell-checking and so forth.</p>
    
<p>By design, [<cite><a class="bibref" data-link-type="biblio" href="#bib-bcp47" title="Tags for Identifying Languages">BCP47</a></cite>] language tags are intended to be ASCII case-insensitive. Applications handling Unicode tag characters would have to apply similar case-insensitivity to ensure correct identification of the language. (The Unicode data doesn't specify case conversion pairings for these characters; this complicates the processing and matching of language tag values encoded using the tag characters.)</p>
  
<p>Moreover, language tags need to be formed from valid subtags to conform to [<cite><a class="bibref" data-link-type="biblio" href="#bib-bcp47" title="Tags for Identifying Languages">BCP47</a></cite>]. Valid subtags are kept in an IANA registry and new subtags are added regularly, so applications dealing with this kind of tagging would need to always check each subtag against the latest version of the registry.</p>
  
<p>The language tag characters do not allow nesting of language tags. For example, if a string contains two languages, such as a quote in French inside an English sentence, Unicode tag characters can only indicate where one language starts. To indicate nested languages, tags would need to be embedded into the text not just prefixed to the front.</p>
  
<p>Although never implemented, other types of tags could be embedded into a string or document using Unicode tag characters. It is possible for these tags to overlap sections of text tagged with a language tag.</p>

<p>Finally, Unicode has recently "recycled" these characters for use in forming sub-regional flags, such as the flag of Scotland (🏴󠁧󠁢󠁳󠁴󠁿󠁧), which is made of the sequence:󠁢󠁳󠁣󠁴󠁿   </p>
  <ul>
  <li><span class="codepoint"><span lang="ang">🏴</span> [<span class="uname">U+1F3F4 WAVING BLACK FLAG</span>]</span></li>
  <li><span class="codepoint"><span lang="ang">󠁧</span> [<span class="uname">U+E0067 TAG LATIN SMALL LETTER G</span>]</span></li>
  <li><span class="codepoint"><span lang="ang">󠁢</span> [<span class="uname">U+E0062 TAG LATIN SMALL LETTER B</span>]</span></li>
  <li><span class="codepoint"><span lang="ang">󠁳</span> [<span class="uname">U+E0073 TAG LATIN SMALL LETTER S</span>]</span></li>
  <li><span class="codepoint"><span lang="ang">󠁣</span> [<span class="uname">U+E0063 TAG LATIN SMALL LETTER C</span>]</span></li>
  <li><span class="codepoint"><span lang="ang">󠁴</span> [<span class="uname">U+E0074 TAG LATIN SMALL LETTER T</span>]</span></li>
  <li><span class="codepoint"><span lang="ang">󠁿</span> [<span class="uname">U+E007F CANCEL TAG</span>]</span></li>
  </ul>
  
  <div class="note" id="issue-container-generatedID-12"><div role="heading" class="ednote-title marker" id="h-ednote" aria-level="5"><span>Editor's note</span></div><p class="">The above is a new feature of emoji added in Unicode 10.0 (version 5.0 of UTR#51) in June 2017. Proper display depends on your system's adoption of this version.</p></div>
  
  </section>
  
</section>

<section id="use-a-language-detection-heuristic"><div class="header-wrapper"><h3 id="language-detection"><bdi class="secno">5.4 </bdi>Use a language detection heuristic</h3><a class="self-link" href="#language-detection" aria-label="Permalink for Section 5.4"></a></div>
	
	<p><strong>This approach is NOT recommended.</strong></p>
	<section id="how-it-works-9"><div class="header-wrapper"><h4 id="language-detection-how"><bdi class="secno">5.4.1 </bdi>How it works</h4><a class="self-link" href="#language-detection-how" aria-label="Permalink for Section 5.4.1"></a></div>
		
		
		<p><a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">Producers</a> do nothing.</p>
		<p><a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">Consumers</a> run a language detection algorithm to determine the language of the text. These are usually statistically based heuristics, such as using n-gram frequency in a language, possibly coupled with other data.</p>
	</section>
	<section id="advantages-9"><div class="header-wrapper"><h4 id="language-detection-advantages"><bdi class="secno">5.4.2 </bdi>Advantages</h4><a class="self-link" href="#language-detection-advantages" aria-label="Permalink for Section 5.4.2"></a></div>
		
		<p>There are no fundamental advantages to this approach.</p>
	</section>
	<section id="issues-9"><div class="header-wrapper"><h4 id="language-detection-issues"><bdi class="secno">5.4.3 </bdi>Issues</h4><a class="self-link" href="#language-detection-issues" aria-label="Permalink for Section 5.4.3"></a></div>
		
		<p>Heuristics are more accurate the longer and more representative the text being scanned is. Short strings may not detect well.</p>
		<p>Language detection is limited to the languages for which one has a detector.</p>
		<p>Inclusions, such as personal or brand names in another language or script, can throw off the detection.</p>
		<p>Language detection tends to be slow and can be memory intensive. Simple consumers probably can't afford the complexity needed to determine the language.</p>
	</section>
</section>
</section>

<section id="localization-considerations-0"><div class="header-wrapper"><h2 id="localization-considerations"><bdi class="secno">6. </bdi>Localization Considerations</h2><a class="self-link" href="#localization-considerations" aria-label="Permalink for Section 6."></a></div>
	
	
	<p>Sometimes a <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> can supply localized values for a given content item or data record by performing some type of <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-language-negotiation">language negotiation</a> between the <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> and the <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumer</a>. Localization then takes place in the <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> using the negotiated language to select the content returned. Such an approach can save on file size, which affects latency, and complexity, since only the language or languages needed by the <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumer</a> need be returned.</p>
	
	<p>However, since this is not always possible, specifications sometimes allow multiple different language values to be returned for a given field. This might be to support runtime localization or because the <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> has multiple different language values and cannot pre-select them appropriately.</p>
	
	<p>In these cases, localization of a content item is done by having the <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> return multiple language representations for the item and letting the <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumer</a> choose the value to display. Such an approach is helpful when the <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">producer</a> cannot negotiate the language (such as when the resulting file is cached for multiple users) and when the number of languages is relatively small. Large collections of languages can result in overly large documents that are cumbersome to work with.</p>
	
	<p>One approach a specification might provide for returning multiple languages of a given field is called <dfn id="dfn-language-indexing" tabindex="0" aria-haspopup="dialog" data-dfn-type="dfn">language indexing</dfn>. In language indexing, a given field's value is an array of key-value pairs. The keys in the array are language tags. The values of each language tag are strings or, ideally, <a href="#Localizable" class="internalDFN" data-link-type="idl" id="ref-for-Localizable-4"><code>Localizable</code></a> objects. Here's an example of what a language indexed field <kbd>title</kbd> might look like:</p>

<aside class="example" id="example-13"><div class="marker">
    <a class="self-link" href="#example-13">Example<bdi> 13</bdi></a>
  </div>
<pre aria-busy="false"><code class="hljs css">"title": [ <span class="hljs-string">"en"</span>: { <span class="hljs-string">"value"</span>: <span class="hljs-string">"Learning Web Design"</span>, <span class="hljs-string">"lang"</span>: <span class="hljs-string">"en"</span> },
           "ar": { <span class="hljs-string">"value"</span>: <span class="hljs-string">"التعلم على شبكة الإنترنت التصميم"</span>, <span class="hljs-string">"lang"</span>: <span class="hljs-string">"ar"</span>,  <span class="hljs-string">"dir"</span>: <span class="hljs-string">"rtl"</span>}, 
           "ja": { <span class="hljs-string">"value"</span>: <span class="hljs-string">"Webデザインを学ぶ"</span>, <span class="hljs-string">"lang"</span>: <span class="hljs-string">"ja"</span> },
           "zh-Hans": { <span class="hljs-string">"value"</span>: <span class="hljs-string">"学习网页设计"</span>, <span class="hljs-string">"lang"</span>: <span class="hljs-string">"zh-Hans"</span>, <span class="hljs-string">"dir"</span>: <span class="hljs-string">"ltr"</span>} ],</code></pre>
</aside>
	
<p>Using the language tag as a key to the value array allow for rapid selection of the correct value for a given request. Notice that, if the value of the language tag is a <a href="#Localizable" class="internalDFN" data-link-type="idl" id="ref-for-Localizable-5"><code>Localizable</code></a>, the language might be repeated in the data structure.</p>

<p>For example, if the language requested were U.S. English (<kbd>en-US</kbd>), this format makes it easier to match and extract the best fitting title object <kbd>{"value": "Learning Web Design", "lang": "en"}</kbd>. An additional potential advantage is that the indexed language tag can indicate the intended audience of the value separately from the language tag of the actual data value. An example of this might be the use of <em>language ranges</em> from [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc4647" title="Matching of Language Tags">RFC4647</a></cite>], as in the following example, where a more specific language value might be wrapped with a less-specific language tag. In this example, the content has been labeled with a specific language tag (<code class="kw" translate="no">de-DE</code>), but is available and applicable to users who speak other variants of German, such as <code class="kw" translate="no">de-CH</code> or <code class="kw" translate="no">de-AT</code>:</p>

<aside class="example" id="example-14"><div class="marker">
    <a class="self-link" href="#example-14">Example<bdi> 14</bdi></a>
  </div>
<pre aria-busy="false"><code class="hljs css">"title": [ {
   <span class="hljs-string">"de"</span>: {<span class="hljs-string">"value"</span>: <span class="hljs-string">"HTML und CSS verstehen"</span>, <span class="hljs-string">"language"</span>: <span class="hljs-string">"de-DE"</span> },
   ...
],</code></pre>
</aside>

<p>A less common example would be when a system supplies a specific value in a different ("wrong") language from the indexing language tag, perhaps because the actual translated value is missing:</p>

<aside class="example" id="example-15"><div class="marker">
    <a class="self-link" href="#example-15">Example<bdi> 15</bdi></a>
  </div>
<pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"title"</span>: [ {
   <span class="hljs-string">"de"</span>: {<span class="hljs-string">"value"</span>: <span class="hljs-string">"Understanding HTML and CSS"</span>, <span class="hljs-string">"language"</span>: <span class="hljs-string">"en-US"</span> }, <span class="hljs-comment">// German not available</span>
   ...
],</code></pre>
</aside>

<p>The primary issue with this approach is the need to extract the indexing language tag from the content in order to generate the index. <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-producer">Producers</a> might also need to have a <a href="#dfn-agreement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-agreement-6">serialization agreement</a> with <a data-type="dfn" href="https://www.w3.org/TR/i18n-glossary/#dfn-consumer">consumers</a> about whether the indexing language tag will be in any way canonicalized. For example, the language tag <code class="kw" translate="no">cel-gaulish</code> is one of the [<cite><a class="bibref" data-link-type="biblio" href="#bib-bcp47" title="Tags for Identifying Languages">BCP47</a></cite>] grandfathered language tags. Some implementations, such as those following the rules in [<cite><a class="bibref" data-link-type="biblio" href="#bib-cldr" title="Unicode Common Locale Data Repository">CLDR</a></cite>], would prefer that this tag be replaced with a modern equivalent (<code class="kw" translate="no">xtg-x-cel-gaulish</code> in this case) for the purposes of language negotiation.</p>

<p>[<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>] defines a <a href="https://www.w3.org/TR/json-ld11/#language-indexing">specific implementation</a> of language indexing, which depends on the use of the <code class="kw" translate="no">@context</code> structure. This structure does not support the use of <a href="#Localizable" class="internalDFN" data-link-type="idl" id="ref-for-Localizable-6"><code>Localizable</code></a> values (only strings or arrays of strings are supported), so changes would be needed to allow some of the above capabilities in [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>] documents.</p>

<aside class="example" id="example-json-ld-language-indexing"><div class="marker">
    <a class="self-link" href="#example-json-ld-language-indexing">Example<bdi> 16</bdi></a><span class="example-title">: JSON-LD Language Indexing</span>
  </div>
<pre aria-busy="false"><code class="hljs json">{
  <span class="hljs-attr">"@context"</span>: {
    <span class="hljs-attr">"example"</span>: <span class="hljs-string">"http://example.com/example/"</span>,
    <span class="hljs-attr">"title"</span>: {
      <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"example:title"</span>,
      <span class="hljs-attr">"@container"</span>: <span class="hljs-string">"@language"</span>
    }
  },
  <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"http://example.com/Learning%20Web%20Design"</span>,
  <span class="hljs-attr">"title"</span>: { <span class="hljs-attr">"en"</span>     : <span class="hljs-string">"Learning Web Design"</span>,
             <span class="hljs-attr">"ar"</span>     : <span class="hljs-string">"التعلم على شبكة الإنترنت التصميم"</span>, 
             <span class="hljs-attr">"ja"</span>     : <span class="hljs-string">"Webデザインを学ぶ"</span>,
             <span class="hljs-attr">"zh-Hans"</span>: <span class="hljs-string">"学习网页设计"</span> 
   }
}</code></pre>
</aside>
</section>







<section class="appendix" id="Localizable-String-Dictionary"><div class="header-wrapper"><h2 id="use-the-localizable-data-structure"><bdi class="secno">A. </bdi>The Localizable WebIDL Dictionary</h2><a class="self-link" href="#use-the-localizable-data-structure" aria-label="Permalink for Appendix A."></a></div>
	

	
	<p>This section contains a WebIDL definition for a <code class="kw" translate="no">Localizable</code> dictionary.</p>
	
	<p>To be effective, specification authors should consistently use the same formats and data structures so that the majority of data formats are interoperable (in other words, so that data can be copied between many formats without having to apply additional processing). We recommend adoption of the Localizable WebIDL "dictionary" as the best available format for JSON-derived formats to do that.</p>

<p>By defining the language and direction in a WebIDL dictionary form, specifications can incorporate language and direction metadata for a given String value succinctly. Implementations can recyle the dictionary implementation straightforwardly.</p>
	
	<aside class="example" id="example-17"><div class="marker">
    <a class="self-link" href="#example-17">Example<bdi> 17</bdi></a>
  </div>
<p><code><dfn id="Localizable" data-export="" data-dfn-type="dictionary" data-idl="dictionary" data-title="Localizable" data-dfn-for="" tabindex="0" aria-haspopup="dialog">Localizable</dfn></code> dictionary</p>
<pre class="def idl" data-dfn-for="Localizable" data-link-for="Localizable" id="webidl-1384431176"><span class="idlHeader"><a class="self-link" href="#webidl-1384431176">WebIDL</a></span><code><span data-idl="" class="idlDictionary" id="idl-def-localizable" data-title="Localizable">dictionary <a class="internalDFN idlID" data-link-type="dictionary" href="#Localizable" id="ref-for-Localizable-7"><code>Localizable</code></a> {<span data-idl="" class="idlMember" id="idl-def-localizable-value" data-title="value" data-dfn-for="Localizable"><span class="idlType">
    <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <dfn data-export="" data-dfn-type="dict-member" id="dom-localizable-value" data-idl="field" data-title="value" data-dfn-for="Localizable" data-type="DOMString" class="idlName" tabindex="0" aria-haspopup="dialog"><code>value</code></dfn>;</span><span data-idl="" class="idlMember" id="idl-def-localizable-lang" data-title="lang" data-dfn-for="Localizable"><span class="idlType">
    <a data-link-type="idl" data-type="interface" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></span> <dfn data-export="" data-dfn-type="dict-member" id="dom-localizable-lang" data-idl="field" data-title="lang" data-dfn-for="Localizable" data-type="DOMString" class="idlName" tabindex="0" aria-haspopup="dialog"><code>lang</code></dfn>;</span><span data-idl="" class="idlMember" id="idl-def-localizable-dir" data-title="dir" data-dfn-for="Localizable"><span class="idlType">
    <a data-link-type="idl" href="#dom-textdirection" class="internalDFN" id="ref-for-dom-textdirection-1"><code>TextDirection</code></a></span> <dfn data-export="" data-dfn-type="dict-member" id="dom-localizable-dir" data-idl="field" data-title="dir" data-dfn-for="Localizable" data-type="TextDirection" class="idlName" tabindex="0" aria-haspopup="dialog"><code>dir</code></dfn> = "auto";</span>
};</span></code></pre><dl>
	<dt><dfn data-dfn-for="localizable" data-dfn-type="dfn" id="localizable-value" data-idl="" data-title="value" class="lint-ignore" tabindex="0" aria-haspopup="dialog">
	
	<code>value</code></dfn> member</dt>
	<dd>The string containing the data value of this field.</dd>
	<dt><dfn data-dfn-for="localizable" data-dfn-type="dfn" id="localizable-lang" data-idl="" data-title="lang" class="lint-ignore" tabindex="0" aria-haspopup="dialog">
	
	<code>lang</code></dfn> member</dt>
	<dd>A [<cite><a class="bibref" data-link-type="biblio" href="#bib-bcp47" title="Tags for Identifying Languages">BCP47</a></cite>] language tag that specifies the primary language for the values of the human-readable
members of the inheriting dictionary.</dd>
<dt><dfn data-dfn-for="localizable" data-dfn-type="dfn" id="localizable-dir" data-idl="" data-title="dir" class="lint-ignore" tabindex="0" aria-haspopup="dialog"><code>
dir</code></dfn> member</dt>
<dd>Specifies the <a data-link-type="dfn|abstract-op" href="#dfn-string-direction" class="internalDFN" id="ref-for-dfn-string-direction-71">string direction</a> for the human-readable members of an inheriting dictionary.</dd></dl>
<div data-dfn-for="TextDirection" data-link-for="TextDirection" id="textdirection-enum" typeof="bibo:Chapter" resource="#textdirection-enum" property="bibo:hasPart">
	<p id="h-textdirection-enum" resource="#h-textdirection-enum"><dfn data-dfn-for="" data-dfn-type="dfn" id="textdirection" data-idl="" data-title="TextDirection" class="lint-ignore" tabindex="0" aria-haspopup="dialog">
<code>TextDirection</code></dfn> enum</p>
<pre class="def idl" id="webidl-1579072325"><span class="idlHeader"><a class="self-link" href="#webidl-1579072325">WebIDL</a></span><code><span data-idl="" class="idlEnum" id="idl-def-textdirection" data-title="TextDirection">enum <dfn data-export="" data-dfn-type="enum" id="dom-textdirection" data-idl="enum" data-title="TextDirection" data-dfn-for="" class="idlID" tabindex="0" aria-haspopup="dialog"><code>TextDirection</code></dfn> {    
    <span class="idlEnumItem">"<dfn data-export="" data-dfn-type="enum-value" id="dom-textdirection-auto" data-idl="enum-value" data-title="auto" data-dfn-for="TextDirection" tabindex="0" aria-haspopup="dialog"><code>auto</code></dfn>"</span>,
    <span class="idlEnumItem">"<dfn data-export="" data-dfn-type="enum-value" id="dom-textdirection-ltr" data-idl="enum-value" data-title="ltr" data-dfn-for="TextDirection" tabindex="0" aria-haspopup="dialog"><code>ltr</code></dfn>"</span>,    
    <span class="idlEnumItem">"<dfn data-export="" data-dfn-type="enum-value" id="dom-textdirection-rtl" data-idl="enum-value" data-title="rtl" data-dfn-for="TextDirection" tabindex="0" aria-haspopup="dialog"><code>rtl</code></dfn>"</span>
};</span></code></pre>
<p>The text-direction values are the following, implying that the value of the human-readable members is by default:</p>
<dl><dt><dfn data-dfn-for="textdirection" data-dfn-type="dfn" id="textdirection-auto" data-idl="" data-title="auto" class="lint-ignore" tabindex="0" aria-haspopup="dialog">
	<code>auto</code></dfn></dt><dd> Directionality is determined by the Unicode Bidirectional Algorithm [<cite><a class="bibref" data-link-type="biblio" href="#bib-uax9" title="Unicode Bidirectional Algorithm">UAX9</a></cite>] algorithm.</dd>
<dt><dfn data-dfn-for="textdirection" data-dfn-type="dfn" id="textdirection-ltr" data-idl="" data-title="ltr" class="lint-ignore" tabindex="0" aria-haspopup="dialog">
	<code>ltr</code></dfn></dt><dd>Left-to-right text.</dd>
<dt><dfn data-dfn-for="textdirection" data-dfn-type="dfn" id="textdirection-rtl" data-idl="" data-title="rtl" class="lint-ignore" tabindex="0" aria-haspopup="dialog">
	<code>rtl</code></dfn></dt><dd>Right-to-left text.</dd></dl>
</div>
</aside>

</section>


<section class="appendix" id="Acknowledgements"><div class="header-wrapper"><h2 id="b-acknowledgements"><bdi class="secno">B. </bdi>Acknowledgements</h2><a class="self-link" href="#Acknowledgements" aria-label="Permalink for Appendix B."></a></div>



<p>The Internationalization (I18N) Working Group would like to thank 
the following contributors to this document: 
    Mati Allouche, 
    David Baron,
    Ivan Herman,
    Tobie Langel,
    Sangwhan Moon,
    Felix Sasaki, 
    Najib Tounsi, 
    
 and many others.</p>

<p>The following pages formed the initial basis of this document:</p>
<ul>
  <li><a href="https://w3c.github.io/i18n-discuss/notes/annotation-language-use-cases.html">Use cases for language information in web annotations</a></li>
  <li><a href="https://w3c.github.io/i18n-discuss/notes/string-base-direction.html">Support for bidi text in strings</a></li>
  <li><a href="https://w3c.github.io/i18n-discuss/notes/json-bidi.html">Notes on JSON strings and text direction</a></li>
</ul>

</section>



<script>
// set up self-links
reqs = document.querySelectorAll('.req')
for (let i=0; i<reqs.length; i++) {
	if (reqs[i].id) {
		a = document.createElement('a')
		a.href = '#'+reqs[i].id
		a.textContent = '§'
		a.className = 'self-link'
		reqs[i].prepend(a)
		}
	}
</script>



<section id="references" class="appendix"><div class="header-wrapper"><h2 id="c-references"><bdi class="secno">C. </bdi>References</h2><a class="self-link" href="#references" aria-label="Permalink for Appendix C."></a></div><section id="informative-references"><div class="header-wrapper"><h3 id="c-1-informative-references"><bdi class="secno">C.1 </bdi>Informative references</h3><a class="self-link" href="#informative-references" aria-label="Permalink for Appendix C.1"></a></div>
    
    <dl class="bibliography"><dt id="bib-bcp47">[BCP47]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc5646"><cite>Tags for Identifying Languages</cite></a>. A. Phillips, Ed.; M. Davis, Ed..  IETF. September 2009. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc5646">https://www.rfc-editor.org/rfc/rfc5646</a>
    </dd><dt id="bib-cldr">[CLDR]</dt><dd>
      <a href="https://cldr.unicode.org/"><cite>Unicode Common Locale Data Repository</cite></a>.  Unicode Consortium. URL: <a href="https://cldr.unicode.org/">https://cldr.unicode.org/</a>
    </dd><dt id="bib-css-writing-modes-4">[CSS-WRITING-MODES-4]</dt><dd>
      <a href="https://www.w3.org/TR/css-writing-modes-4/"><cite>CSS Writing Modes Level 4</cite></a>. Elika Etemad; Koji Ishii.  W3C. 30 July 2019. W3C Candidate Recommendation. URL: <a href="https://www.w3.org/TR/css-writing-modes-4/">https://www.w3.org/TR/css-writing-modes-4/</a>
    </dd><dt id="bib-html">[HTML]</dt><dd>
      <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Anne van Kesteren; Domenic Denicola; Ian Hickson; Philip Jägenstedt; Simon Pieters.  WHATWG. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
    </dd><dt id="bib-i18n-glossary">[I18N-GLOSSARY]</dt><dd>
      <a href="https://www.w3.org/TR/i18n-glossary/"><cite>Internationalization Glossary</cite></a>. Richard Ishida; Addison Phillips.  W3C. 21 March 2024. W3C Working Group Note. URL: <a href="https://www.w3.org/TR/i18n-glossary/">https://www.w3.org/TR/i18n-glossary/</a>
    </dd><dt id="bib-international-specs">[INTERNATIONAL-SPECS]</dt><dd>
      <a href="https://www.w3.org/TR/international-specs/"><cite>Internationalization Best Practices for Spec Developers</cite></a>. Richard Ishida; Addison Phillips.  W3C. 21 March 2024. W3C Working Group Note. URL: <a href="https://www.w3.org/TR/international-specs/">https://www.w3.org/TR/international-specs/</a>
    </dd><dt id="bib-its20">[ITS20]</dt><dd>
      <a href="https://www.w3.org/TR/its20/"><cite>Internationalization Tag Set (ITS) Version 2.0</cite></a>. David Filip; Shaun McCance; David Lewis; Christian Lieske; Arle Lommel; Jirka Kosek; Felix Sasaki; Yves Savourel.  W3C. 29 October 2013. W3C Recommendation. URL: <a href="https://www.w3.org/TR/its20/">https://www.w3.org/TR/its20/</a>
    </dd><dt id="bib-json-ld">[JSON-LD]</dt><dd>
      <a href="https://www.w3.org/TR/json-ld/"><cite>JSON-LD 1.0</cite></a>. Manu Sporny; Gregg Kellogg; Markus Lanthaler.  W3C. 3 November 2020. W3C Recommendation. URL: <a href="https://www.w3.org/TR/json-ld/">https://www.w3.org/TR/json-ld/</a>
    </dd><dt id="bib-ldml">[LDML]</dt><dd>
      <a href="https://unicode.org/reports/tr35/"><cite>Unicode Technical Standard #35: Unicode Locale Data Markup Language (LDML)</cite></a>. Mark Davis; CLDR Contributors. URL: <a href="https://unicode.org/reports/tr35/">https://unicode.org/reports/tr35/</a>
    </dd><dt id="bib-rdf-plain-literal">[RDF-PLAIN-LITERAL]</dt><dd>
      <a href="https://www.w3.org/TR/rdf-plain-literal/"><cite>rdf:PlainLiteral: A Datatype for RDF Plain Literals (Second Edition)</cite></a>. Jie Bao; Sandro Hawke; Boris Motik; Peter Patel-Schneider; Axel Polleres.  W3C. 11 December 2012. W3C Recommendation. URL: <a href="https://www.w3.org/TR/rdf-plain-literal/">https://www.w3.org/TR/rdf-plain-literal/</a>
    </dd><dt id="bib-rfc2119">[RFC2119]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner.  IETF. March 1997. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>
    </dd><dt id="bib-rfc4647">[RFC4647]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc4647"><cite>Matching of Language Tags</cite></a>. A. Phillips, Ed.; M. Davis, Ed..  IETF. September 2006. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc4647">https://www.rfc-editor.org/rfc/rfc4647</a>
    </dd><dt id="bib-rfc9000">[RFC9000]</dt><dd>
      <a href="https://www.rfc-editor.org/rfc/rfc9000"><cite>QUIC: A UDP-Based Multiplexed and Secure Transport</cite></a>. J. Iyengar, Ed.; M. Thomson, Ed..  IETF. May 2021. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc9000">https://www.rfc-editor.org/rfc/rfc9000</a>
    </dd><dt id="bib-uax9">[UAX9]</dt><dd>
      <a href="https://www.unicode.org/reports/tr9/tr9-48.html"><cite>Unicode Bidirectional Algorithm</cite></a>. Manish Goregaokar मनीष गोरेगांवकर; Robin Leroy.  Unicode Consortium. 15 August 2023. Unicode Standard Annex #9. URL: <a href="https://www.unicode.org/reports/tr9/tr9-48.html">https://www.unicode.org/reports/tr9/tr9-48.html</a>
    </dd><dt id="bib-unicode">[Unicode]</dt><dd>
      <a href="https://www.unicode.org/versions/latest/"><cite>The Unicode Standard</cite></a>.  Unicode Consortium. URL: <a href="https://www.unicode.org/versions/latest/">https://www.unicode.org/versions/latest/</a>
    </dd><dt id="bib-webidl">[WebIDL]</dt><dd>
      <a href="https://webidl.spec.whatwg.org/"><cite>Web IDL Standard</cite></a>. Edgar Chen; Timothy Gu.  WHATWG. Living Standard. URL: <a href="https://webidl.spec.whatwg.org/">https://webidl.spec.whatwg.org/</a>
    </dd><dt id="bib-webtransport">[Webtransport]</dt><dd>
      <a href="https://www.w3.org/TR/webtransport/"><cite>WebTransport</cite></a>. Bernard Aboba; Nidhi Jaju; Victor Vasiliev.  W3C. 20 December 2023. W3C Working Draft. URL: <a href="https://www.w3.org/TR/webtransport/">https://www.w3.org/TR/webtransport/</a>
    </dd><dt id="bib-xml10">[XML10]</dt><dd>
      <a href="https://www.w3.org/TR/xml/"><cite>Extensible Markup Language (XML) 1.0 (Fifth Edition)</cite></a>. Tim Bray; Jean Paoli; Michael Sperberg-McQueen; Eve Maler; François Yergeau et al.  W3C. 26 November 2008. W3C Recommendation. URL: <a href="https://www.w3.org/TR/xml/">https://www.w3.org/TR/xml/</a>
    </dd></dl>
  </section></section><p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-block-direction" aria-label="Links in this document to definition: Block direction">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-block-direction" aria-label="Permalink for definition: Block direction. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-block-direction-1" title="§ 1. Introduction">§ 1. Introduction</a> 
    </li><li>
      <a href="#ref-for-dfn-block-direction-2" title="§ 1.2 Terminology">§ 1.2 Terminology</a> <a href="#ref-for-dfn-block-direction-3" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-block-direction-4" title="§ 1.3.2 Consumers">§ 1.3.2 Consumers</a> 
    </li><li>
      <a href="#ref-for-dfn-block-direction-5" title="§ 2.1.2 Single-Language Localizable Text Field">§ 2.1.2 Single-Language Localizable Text Field</a> <a href="#ref-for-dfn-block-direction-6" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-block-direction-7" title="§ 2.1.3 Resource-wide Defaults">§ 2.1.3 Resource-wide Defaults</a> 
    </li><li>
      <a href="#ref-for-dfn-block-direction-8" title="§ 2. Best Practices, Recommendations, and Gaps">§ 2. Best Practices, Recommendations, and Gaps</a> <a href="#ref-for-dfn-block-direction-9" title="Reference 2">(2)</a> <a href="#ref-for-dfn-block-direction-10" title="Reference 3">(3)</a> 
    </li><li>
      <a href="#ref-for-dfn-block-direction-11" title="§ 2.3 Defining Bidirectional Keywords in Specifications">§ 2.3 Defining Bidirectional Keywords in Specifications</a> <a href="#ref-for-dfn-block-direction-12" title="Reference 2">(2)</a> <a href="#ref-for-dfn-block-direction-13" title="Reference 3">(3)</a> <a href="#ref-for-dfn-block-direction-14" title="Reference 4">(4)</a> 
    </li><li>
      <a href="#ref-for-dfn-block-direction-15" title="§ 2.8 Additional Best Practices">§ 2.8 Additional Best Practices</a> 
    </li><li>
      <a href="#ref-for-dfn-block-direction-16" title="§ 4.2.1 How it works">§ 4.2.1 How it works</a> 
    </li><li>
      <a href="#ref-for-dfn-block-direction-17" title="§ 4.3.3 Issues">§ 4.3.3 Issues</a> 
    </li><li>
      <a href="#ref-for-dfn-block-direction-18" title="§ 4.5.1 How it works">§ 4.5.1 How it works</a> <a href="#ref-for-dfn-block-direction-19" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-block-direction-20" title="§ 4.5.3 Issues">§ 4.5.3 Issues</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-string-direction" aria-label="Links in this document to definition: String direction">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-string-direction" aria-label="Permalink for definition: String direction. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-string-direction-1" title="§ 1.2 Terminology">§ 1.2 Terminology</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-2" title="§ 1.3.1 Producers">§ 1.3.1 Producers</a> <a href="#ref-for-dfn-string-direction-3" title="Reference 2">(2)</a> <a href="#ref-for-dfn-string-direction-4" title="Reference 3">(3)</a> <a href="#ref-for-dfn-string-direction-5" title="Reference 4">(4)</a> <a href="#ref-for-dfn-string-direction-6" title="Reference 5">(5)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-7" title="§ 1.3.2 Consumers">§ 1.3.2 Consumers</a> <a href="#ref-for-dfn-string-direction-8" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-9" title="§ 1.3.3 Serialization Agreements">§ 1.3.3 Serialization Agreements</a> <a href="#ref-for-dfn-string-direction-10" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-11" title="§ 1.4 Strings that are not localizable text">§ 1.4 Strings that are not localizable text</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-12" title="§ 2. Best Practices, Recommendations, and Gaps">§ 2. Best Practices, Recommendations, and Gaps</a> <a href="#ref-for-dfn-string-direction-13" title="Reference 2">(2)</a> <a href="#ref-for-dfn-string-direction-14" title="Reference 3">(3)</a> <a href="#ref-for-dfn-string-direction-15" title="Reference 4">(4)</a> <a href="#ref-for-dfn-string-direction-25" title="Reference 5">(5)</a> <a href="#ref-for-dfn-string-direction-26" title="Reference 6">(6)</a> <a href="#ref-for-dfn-string-direction-27" title="Reference 7">(7)</a> <a href="#ref-for-dfn-string-direction-28" title="Reference 8">(8)</a> <a href="#ref-for-dfn-string-direction-29" title="Reference 9">(9)</a> <a href="#ref-for-dfn-string-direction-30" title="Reference 10">(10)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-16" title="§ 2.1.1 Non-Linguistic Fields">§ 2.1.1 Non-Linguistic Fields</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-17" title="§ 2.1.2 Single-Language Localizable Text Field">§ 2.1.2 Single-Language Localizable Text Field</a> <a href="#ref-for-dfn-string-direction-18" title="Reference 2">(2)</a> <a href="#ref-for-dfn-string-direction-19" title="Reference 3">(3)</a> <a href="#ref-for-dfn-string-direction-20" title="Reference 4">(4)</a> <a href="#ref-for-dfn-string-direction-21" title="Reference 5">(5)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-22" title="§ 2.1.3 Resource-wide Defaults">§ 2.1.3 Resource-wide Defaults</a> <a href="#ref-for-dfn-string-direction-23" title="Reference 2">(2)</a> <a href="#ref-for-dfn-string-direction-24" title="Reference 3">(3)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-31" title="§ 2.3 Defining Bidirectional Keywords in Specifications">§ 2.3 Defining Bidirectional Keywords in Specifications</a> <a href="#ref-for-dfn-string-direction-32" title="Reference 2">(2)</a> <a href="#ref-for-dfn-string-direction-33" title="Reference 3">(3)</a> <a href="#ref-for-dfn-string-direction-34" title="Reference 4">(4)</a> <a href="#ref-for-dfn-string-direction-35" title="Reference 5">(5)</a> <a href="#ref-for-dfn-string-direction-36" title="Reference 6">(6)</a> <a href="#ref-for-dfn-string-direction-37" title="Reference 7">(7)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-38" title="§ 2.5 Guidance for Producers">§ 2.5 Guidance for Producers</a> <a href="#ref-for-dfn-string-direction-39" title="Reference 2">(2)</a> <a href="#ref-for-dfn-string-direction-40" title="Reference 3">(3)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-41" title="§ 2.7 Strings that are part of a legacy protocol or format">§ 2.7 Strings that are part of a legacy protocol or format</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-42" title="§ 3.1 Why is this important?">§ 3.1 Why is this important?</a> <a href="#ref-for-dfn-string-direction-43" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-44" title="§ 3.2 An example">§ 3.2 An example</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-45" title="§ 3.4 What consumers need to do to support direction">§ 3.4 What consumers need to do to support direction</a> <a href="#ref-for-dfn-string-direction-46" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-47" title="§ 4. Approaches Considered for Identifying the String Direction">§ 4. Approaches Considered for Identifying the String Direction</a> <a href="#ref-for-dfn-string-direction-48" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-49" title="§ 4.1.1 How it works">§ 4.1.1 How it works</a> <a href="#ref-for-dfn-string-direction-50" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-51" title="§ 4.2.1 How it works">§ 4.2.1 How it works</a> <a href="#ref-for-dfn-string-direction-52" title="Reference 2">(2)</a> <a href="#ref-for-dfn-string-direction-53" title="Reference 3">(3)</a> <a href="#ref-for-dfn-string-direction-54" title="Reference 4">(4)</a> <a href="#ref-for-dfn-string-direction-55" title="Reference 5">(5)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-56" title="§ 4.2.2 Advantages">§ 4.2.2 Advantages</a> <a href="#ref-for-dfn-string-direction-57" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-58" title="§ 4.3.1 How it works">§ 4.3.1 How it works</a> <a href="#ref-for-dfn-string-direction-59" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-60" title="§ 4.4.1 How it works">§ 4.4.1 How it works</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-61" title="§ 4.5.1 How it works">§ 4.5.1 How it works</a> <a href="#ref-for-dfn-string-direction-62" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-63" title="§ 4.5.2 Advantages">§ 4.5.2 Advantages</a> <a href="#ref-for-dfn-string-direction-64" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-65" title="§ 4.5.4 Other comments">§ 4.5.4 Other comments</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-66" title="§ 4.6.2 Advantages">§ 4.6.2 Advantages</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-67" title="§ 4.7.1 How it works">§ 4.7.1 How it works</a> <a href="#ref-for-dfn-string-direction-68" title="Reference 2">(2)</a> <a href="#ref-for-dfn-string-direction-69" title="Reference 3">(3)</a> <a href="#ref-for-dfn-string-direction-70" title="Reference 4">(4)</a> 
    </li><li>
      <a href="#ref-for-dfn-string-direction-71" title="§ A. The Localizable WebIDL Dictionary">§ A. The Localizable WebIDL Dictionary</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-agreement" aria-label="Links in this document to definition: agreement">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-agreement" aria-label="Permalink for definition: agreement. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-agreement-1" title="§ 1.2 Terminology">§ 1.2 Terminology</a> 
    </li><li>
      <a href="#ref-for-dfn-agreement-2" title="§ 2. Best Practices, Recommendations, and Gaps">§ 2. Best Practices, Recommendations, and Gaps</a> 
    </li><li>
      <a href="#ref-for-dfn-agreement-3" title="§ 3.1 Why is this important?">§ 3.1 Why is this important?</a> 
    </li><li>
      <a href="#ref-for-dfn-agreement-4" title="§ 3.3 Isn't Unicode enough?">§ 3.3 Isn't Unicode enough?</a> 
    </li><li>
      <a href="#ref-for-dfn-agreement-5" title="§ 4.6 Require bidi markup for content">§ 4.6 Require bidi markup for content</a> 
    </li><li>
      <a href="#ref-for-dfn-agreement-6" title="§ 6. Localization Considerations">§ 6. Localization Considerations</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-resource-wide-default" aria-label="Links in this document to definition: resource-wide default">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-resource-wide-default" aria-label="Permalink for definition: resource-wide default. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-resource-wide-default-1" title="§ 2.5 Guidance for Producers">§ 2.5 Guidance for Producers</a> <a href="#ref-for-dfn-resource-wide-default-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-resource-wide-default-3" title="Reference 3">(3)</a> <a href="#ref-for-dfn-resource-wide-default-4" title="Reference 4">(4)</a> <a href="#ref-for-dfn-resource-wide-default-5" title="Reference 5">(5)</a> <a href="#ref-for-dfn-resource-wide-default-6" title="Reference 6">(6)</a> <a href="#ref-for-dfn-resource-wide-default-7" title="Reference 7">(7)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-directional-metadata-field" aria-label="Links in this document to definition: Directional metadata field">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-directional-metadata-field" aria-label="Permalink for definition: Directional metadata field. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-directional-metadata-field-1" title="§ 2.3 Defining Bidirectional Keywords in Specifications">§ 2.3 Defining Bidirectional Keywords in Specifications</a> <a href="#ref-for-dfn-directional-metadata-field-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-directional-metadata-field-3" title="Reference 3">(3)</a> <a href="#ref-for-dfn-directional-metadata-field-4" title="Reference 4">(4)</a> <a href="#ref-for-dfn-directional-metadata-field-5" title="Reference 5">(5)</a> <a href="#ref-for-dfn-directional-metadata-field-6" title="Reference 6">(6)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-direction-attribute" aria-label="Links in this document to definition: Direction attribute">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-direction-attribute" aria-label="Permalink for definition: Direction attribute. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-direction-attribute-1" title="§ 2.3 Defining Bidirectional Keywords in Specifications">§ 2.3 Defining Bidirectional Keywords in Specifications</a> <a href="#ref-for-dfn-direction-attribute-2" title="Reference 2">(2)</a> <a href="#ref-for-dfn-direction-attribute-3" title="Reference 3">(3)</a> <a href="#ref-for-dfn-direction-attribute-4" title="Reference 4">(4)</a> <a href="#ref-for-dfn-direction-attribute-5" title="Reference 5">(5)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dfn-language-indexing" aria-label="Links in this document to definition: language indexing">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-language-indexing" aria-label="Permalink for definition: language indexing. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dfn-language-indexing-1" title="§ 2.8 Additional Best Practices">§ 2.8 Additional Best Practices</a> <a href="#ref-for-dfn-language-indexing-2" title="Reference 2">(2)</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-Localizable" aria-label="Links in this document to definition: Localizable">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#Localizable" aria-label="Permalink for definition: Localizable. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> <a class="marker idl-block" title="Jump to IDL declaration" href="#webidl-1384431176">IDL</a>
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-Localizable-1" title="§ 2.1.2 Single-Language Localizable Text Field">§ 2.1.2 Single-Language Localizable Text Field</a> 
    </li><li>
      <a href="#ref-for-Localizable-2" title="§ 2.8 Additional Best Practices">§ 2.8 Additional Best Practices</a> <a href="#ref-for-Localizable-3" title="Reference 2">(2)</a> 
    </li><li>
      <a href="#ref-for-Localizable-4" title="§ 6. Localization Considerations">§ 6. Localization Considerations</a> <a href="#ref-for-Localizable-5" title="Reference 2">(2)</a> <a href="#ref-for-Localizable-6" title="Reference 3">(3)</a> 
    </li><li>
      <a href="#ref-for-Localizable-7" title="§ A. The Localizable WebIDL Dictionary">§ A. The Localizable WebIDL Dictionary</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-localizable-value" aria-label="Links in this document to definition: value">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-localizable-value" aria-label="Permalink for definition: value. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-localizable-lang" aria-label="Links in this document to definition: lang">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-localizable-lang" aria-label="Permalink for definition: lang. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-localizable-dir" aria-label="Links in this document to definition: dir">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-localizable-dir" aria-label="Permalink for definition: dir. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-localizable-value" aria-label="Links in this document to definition: value">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#localizable-value" aria-label="Permalink for definition: value. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-localizable-lang" aria-label="Links in this document to definition: lang">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#localizable-lang" aria-label="Permalink for definition: lang. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-localizable-dir" aria-label="Links in this document to definition: dir">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#localizable-dir" aria-label="Permalink for definition: dir. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-textdirection" aria-label="Links in this document to definition: TextDirection">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#textdirection" aria-label="Permalink for definition: TextDirection. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-textdirection" aria-label="Links in this document to definition: TextDirection">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-textdirection" aria-label="Permalink for definition: TextDirection. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
    <li>
      <a href="#ref-for-dom-textdirection-1" title="§ A. The Localizable WebIDL Dictionary">§ A. The Localizable WebIDL Dictionary</a> 
    </li>
  </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-textdirection-auto" aria-label="Links in this document to definition: auto">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-textdirection-auto" aria-label="Permalink for definition: auto. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-textdirection-ltr" aria-label="Links in this document to definition: ltr">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-textdirection-ltr" aria-label="Permalink for definition: ltr. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-dom-textdirection-rtl" aria-label="Links in this document to definition: rtl">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dom-textdirection-rtl" aria-label="Permalink for definition: rtl. Activate to close this dialog.">Permalink</a>
        <span class="marker dfn-exported" title="Definition can be referenced by other specifications">exported</span> 
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-textdirection-auto" aria-label="Links in this document to definition: auto">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#textdirection-auto" aria-label="Permalink for definition: auto. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-textdirection-ltr" aria-label="Links in this document to definition: ltr">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#textdirection-ltr" aria-label="Permalink for definition: ltr. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><div class="dfn-panel" hidden="" role="dialog" aria-modal="true" id="dfn-panel-for-textdirection-rtl" aria-label="Links in this document to definition: rtl">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#textdirection-rtl" aria-label="Permalink for definition: rtl. Activate to close this dialog.">Permalink</a>
         
      </div>
      <p><b>Referenced in:</b></p>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </div><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(setupPanel);
} else {
  setupPanel();
}

function setupPanel() {
  const listener = panelListener();
  document.body.addEventListener("keydown", listener);
  document.body.addEventListener("click", listener);
}

function panelListener() {
  /** @type {HTMLElement} */
  let panel = null;
  return event => {
    const { target, type } = event;

    if (!(target instanceof HTMLElement)) return;

    // For keys, we only care about Enter key to activate the panel
    // otherwise it's activated via a click.
    if (type === "keydown" && event.key !== "Enter") return;

    const action = deriveAction(event);

    switch (action) {
      case "show": {
        hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = target.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        const coords = deriveCoordinates(event);
        displayPanel(dfn, panel, coords);
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        panel = null;
        break;
      }
    }
  };
}

/**
 * @param {MouseEvent|KeyboardEvent} event
 */
function deriveCoordinates(event) {
  const target = /** @type HTMLElement */ (event.target);

  // We prevent synthetic AT clicks from putting
  // the dialog in a weird place. The AT events sometimes
  // lack coordinates, so they have clientX/Y = 0
  const rect = target.getBoundingClientRect();
  if (
    event instanceof MouseEvent &&
    event.clientX >= rect.left &&
    event.clientY >= rect.top
  ) {
    // The event probably happened inside the bounding rect...
    return { x: event.clientX, y: event.clientY };
  }

  // Offset to the middle of the element
  const x = rect.x + rect.width / 2;
  // Placed at the bottom of the element
  const y = rect.y + rect.height;
  return { x, y };
}

/**
 * @param {Event} event
 */
function deriveAction(event) {
  const target = /** @type {HTMLElement} */ (event.target);
  const hitALink = !!target.closest("a");
  if (target.closest("dfn:not([data-cite]), .index-term")) {
    return hitALink ? "none" : "show";
  }
  if (target.closest(".dfn-panel")) {
    if (hitALink) {
      return target.classList.contains("self-link") ? "hide" : "dock";
    }
    const panel = target.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : "none";
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return "none";
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }

  // As it's a dialog, we trap focus.
  // TODO: when <dialog> becomes a implemented, we should really
  // use that.
  trapFocus(panel, dfn);
}

/**
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function trapFocus(panel, dfn) {
  /** @type NodeListOf<HTMLAnchorElement> elements */
  const anchors = panel.querySelectorAll("a[href]");
  // No need to trap focus
  if (!anchors.length) return;

  // Move focus to first anchor element
  const first = anchors.item(0);
  first.focus();

  const trapListener = createTrapListener(anchors, panel, dfn);
  panel.addEventListener("keydown", trapListener);

  // Hiding the panel releases the trap
  const mo = new MutationObserver(records => {
    const [record] = records;
    const target = /** @type HTMLElement */ (record.target);
    if (target.hidden) {
      panel.removeEventListener("keydown", trapListener);
      mo.disconnect();
    }
  });
  mo.observe(panel, { attributes: true, attributeFilter: ["hidden"] });
}

/**
 *
 * @param {NodeListOf<HTMLAnchorElement>} anchors
 * @param {HTMLElement} panel
 * @param {HTMLElement} dfn
 * @returns
 */
function createTrapListener(anchors, panel, dfn) {
  const lastIndex = anchors.length - 1;
  let currentIndex = 0;
  return event => {
    switch (event.key) {
      // Hitting "Tab" traps us in a nice loop around elements.
      case "Tab": {
        event.preventDefault();
        currentIndex += event.shiftKey ? -1 : +1;
        if (currentIndex < 0) {
          currentIndex = lastIndex;
        } else if (currentIndex > lastIndex) {
          currentIndex = 0;
        }
        anchors.item(currentIndex).focus();
        break;
      }

      // Hitting "Enter" on an anchor releases the trap.
      case "Enter":
        hidePanel(panel);
        break;

      // Hitting "Escape" returns focus to dfn.
      case "Escape":
        hidePanel(panel);
        dfn.focus();
        return;
    }
  };
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  if (!panel) return;
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script></body></html>